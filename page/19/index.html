<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="google-site-verification" content="2k9N_1AINrpZtRVd2DTmGWusoSitSdkkRTBT7tORVAY">
  <meta name="baidu-site-verification" content="IFiFMa7Cit">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"iziyang.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="目前是一名 SRE，爱好 Go 和 Python">
<meta property="og:type" content="website">
<meta property="og:title" content="原少子杨">
<meta property="og:url" content="http://iziyang.github.io/page/19/index.html">
<meta property="og:site_name" content="原少子杨">
<meta property="og:description" content="目前是一名 SRE，爱好 Go 和 Python">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="原少子杨">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://iziyang.github.io/page/19/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>原少子杨 - 聊聊技术、产品和商业</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">原少子杨</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">聊聊技术、产品和商业</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-所有文章">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>所有文章</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-sre">

    <a href="/categories/SRE" rel="section"><i class="fa fa-cloud fa-fw"></i>SRE</a>

  </li>
        <li class="menu-item menu-item-编程">

    <a href="/categories/%E7%BC%96%E7%A8%8B" rel="section"><i class="fa fa-code fa-fw"></i>编程</a>

  </li>
        <li class="menu-item menu-item-读书">

    <a href="/categories/%E8%AF%BB%E4%B9%A6" rel="section"><i class="fa fa-book fa-fw"></i>读书</a>

  </li>
        <li class="menu-item menu-item-杂谈">

    <a href="/categories/%E6%9D%82%E8%B0%88" rel="section"><i class="fa fa-pencil-alt fa-fw"></i>杂谈</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://iziyang.github.io/2018/11/07/learn-django0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://s3plus.meituan.net/v1/mss_f32142e8d47149129e9550e929704625/yzz-test-image/qrcode_for_gh_3cfae3cf61d9_1280.jpg">
      <meta itemprop="name" content="原少子杨">
      <meta itemprop="description" content="目前是一名 SRE，爱好 Go 和 Python">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="原少子杨">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/07/learn-django0/" class="post-title-link" itemprop="url">1. 如何搭建一个虚拟的 Python 环境？</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-07 14:44:27" itemprop="dateCreated datePublished" datetime="2018-11-07T14:44:27+08:00">2018-11-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-17 19:59:59" itemprop="dateModified" datetime="2021-05-17T19:59:59+08:00">2021-05-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a>
                </span>
            </span>

          
            <span id="/2018/11/07/learn-django0/" class="post-meta-item leancloud_visitors" data-flag-title="1. 如何搭建一个虚拟的 Python 环境？" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/11/07/learn-django0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/11/07/learn-django0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>通常在我们在编写 Python 程序的时候，需要什么库我们就直接用 pip 安装了，这种情况下是全局式的安装。我们在创建一个 Python 项目的时候，例如有的项目需要 Python3，有的需要 Python2，为了避免项目依赖的互相影响以及去除不需要的库，通常会通过虚拟环境来解决。</p>
<p>这个虚拟环境其实相当于另外独立出一个 Python 环境，有自己的独立的库，独立的依赖关系，是在开发项目时候的利器。话不多说，下面讲一下使用方法。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/11/07/learn-django0/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://iziyang.github.io/2018/07/09/python-advanced/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://s3plus.meituan.net/v1/mss_f32142e8d47149129e9550e929704625/yzz-test-image/qrcode_for_gh_3cfae3cf61d9_1280.jpg">
      <meta itemprop="name" content="原少子杨">
      <meta itemprop="description" content="目前是一名 SRE，爱好 Go 和 Python">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="原少子杨">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/09/python-advanced/" class="post-title-link" itemprop="url">Python 高级教程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-09 21:34:54" itemprop="dateCreated datePublished" datetime="2018-07-09T21:34:54+08:00">2018-07-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-17 19:59:59" itemprop="dateModified" datetime="2021-05-17T19:59:59+08:00">2021-05-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a>
                </span>
            </span>

          
            <span id="/2018/07/09/python-advanced/" class="post-meta-item leancloud_visitors" data-flag-title="Python 高级教程" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/07/09/python-advanced/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/07/09/python-advanced/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><h2 id="如何将列表，字典等进行合并"><a href="#如何将列表，字典等进行合并" class="headerlink" title="如何将列表，字典等进行合并"></a>如何将列表，字典等进行合并</h2><h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><ul>
<li>使用 +</li>
<li>extend</li>
<li>切片</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">l1 =[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">l2 = [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">l1 + l2  <span class="comment"># 会创建第三个列表</span></span><br><span class="line">Out[<span class="number">22</span>]: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">l1.extend(l2)  <span class="comment"># 会修改 l1</span></span><br><span class="line">l1[<span class="built_in">len</span>(l1):<span class="built_in">len</span>(l2)] = l2  <span class="comment"># 会修改 l1</span></span><br></pre></td></tr></table></figure>



<h3 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># </span></span><br><span class="line">context = &#123;&#125;</span><br><span class="line">context.update(defaults)</span><br><span class="line">context.update(user)</span><br><span class="line"><span class="comment"># </span></span><br><span class="line">context = defaults.copy()</span><br><span class="line">context.update(user)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">context = <span class="built_in">dict</span>(defaults)</span><br><span class="line">context.update(user)</span><br><span class="line"><span class="comment"># python 3.5</span></span><br><span class="line">context = &#123;**defaults, **user&#125;</span><br></pre></td></tr></table></figure>

<h2 id="如何筛选列表、集合、字典中的数据"><a href="#如何筛选列表、集合、字典中的数据" class="headerlink" title="如何筛选列表、集合、字典中的数据"></a>如何筛选列表、集合、字典中的数据</h2><h3 id="列表-1"><a href="#列表-1" class="headerlink" title="列表"></a>列表</h3><ul>
<li>filter 函数</li>
<li>列表解析</li>
</ul>
<p>列表解析更好，时间更短。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line">data = [randint(-<span class="number">10</span>, <span class="number">10</span>) <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">10</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># filter 函数</span></span><br><span class="line">data2 = <span class="built_in">filter</span>(<span class="keyword">lambda</span> i: i &gt; <span class="number">0</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表解析</span></span><br><span class="line">data3 = [x <span class="keyword">for</span> x <span class="keyword">in</span> data <span class="keyword">if</span> x &gt; <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> data, data2, data3</span><br></pre></td></tr></table></figure>

<h3 id="字典-1"><a href="#字典-1" class="headerlink" title="字典"></a>字典</h3><ul>
<li>字典解析</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dictdata = &#123;x: randint(<span class="number">0</span>, <span class="number">100</span>) <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">0</span>, <span class="number">50</span>)&#125;</span><br><span class="line">dictdata2 = &#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> dictdata.iteritems() <span class="keyword">if</span> v &gt;= <span class="number">60</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><ul>
<li>集合解析</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setdata = <span class="built_in">set</span>(data)</span><br><span class="line">setdata2 = &#123;x <span class="keyword">for</span> x <span class="keyword">in</span> setdata <span class="keyword">if</span> x &gt; <span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="如何根据字典中值的大小，对字典中的项排序"><a href="#如何根据字典中值的大小，对字典中的项排序" class="headerlink" title="如何根据字典中值的大小，对字典中的项排序"></a>如何根据字典中值的大小，对字典中的项排序</h2><ul>
<li>使用内置函数 sorted<ol>
<li>使用 zip 将字典转换为元组（将值放在第一个）</li>
<li>使用 sorted 排序</li>
</ol>
</li>
<li>使用 sorted 函数的 key 参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">d = &#123;x:randint(<span class="number">60</span>,<span class="number">100</span>) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="string">&#x27;xyzabc&#x27;</span>&#125;</span><br><span class="line"><span class="built_in">sorted</span>(<span class="built_in">zip</span>(d.itervalues(),d.iterkeys()))</span><br><span class="line"><span class="comment"># Out[7]: [(65, &#x27;a&#x27;), (68, &#x27;x&#x27;), (88, &#x27;z&#x27;), (91, &#x27;y&#x27;), (96, &#x27;b&#x27;), (98, &#x27;c&#x27;)]</span></span><br><span class="line"><span class="built_in">sorted</span>(d.iteritems(),key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<h2 id="如何为元组中的每个元素命名，提高程序可读性"><a href="#如何为元组中的每个元素命名，提高程序可读性" class="headerlink" title="如何为元组中的每个元素命名，提高程序可读性"></a>如何为元组中的每个元素命名，提高程序可读性</h2><ul>
<li>定义类似于其他语言中的枚举类型，也就是定义一系列数值常量</li>
<li>使用标准库中的 collections.namedtuple</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">student = namedtuple(<span class="string">&#x27;student&#x27;</span>,[<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>])</span><br><span class="line">s1 = student(<span class="string">&#x27;jim&#x27;</span>,<span class="number">16</span>)  <span class="comment"># 位置参数，也可使用关键字参数</span></span><br><span class="line">s2 = student(name=<span class="string">&#x27;tom&#x27;</span>,age=<span class="number">12</span>)</span><br><span class="line"><span class="comment"># 可以使用类对象的方式访问数据</span></span><br><span class="line">s1.name</span><br><span class="line"><span class="comment"># Out[19]: &#x27;jim&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="如何统计序列中元素的出现频度"><a href="#如何统计序列中元素的出现频度" class="headerlink" title="如何统计序列中元素的出现频度"></a>如何统计序列中元素的出现频度</h2><p>问题：</p>
<ol>
<li>找到某随机序列中出现次数最高的三个元素</li>
<li>对某英文文章的单词进行词频统计，找到出现次数最高的 10 个单词</li>
</ol>
<ul>
<li>构造字典</li>
<li>使用 collections 下的 Counter</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">data = [randint(<span class="number">0</span>, <span class="number">10</span>) <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">20</span>)]</span><br><span class="line"><span class="comment"># 第一种方式</span></span><br><span class="line">c = <span class="built_in">dict</span>.fromkeys(data,<span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> data:</span><br><span class="line">    c[x] += <span class="number">1</span></span><br><span class="line"><span class="comment"># 然后回到之前的问题，根据字典的值，对字典的键排序</span></span><br><span class="line"><span class="built_in">sorted</span>(c.iteritems(),key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>]) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二种方式</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line">c2 = Counter(data)</span><br><span class="line"><span class="comment"># c2</span></span><br><span class="line"><span class="comment"># Out[33]: Counter(&#123;0: 4, 1: 1, 2: 1, 3: 3, 4: 2, 5: 1, 6: 3, 8: 1, 9: 3, 10: 1&#125;)</span></span><br><span class="line">c2.most_common(<span class="number">3</span>)  <span class="comment"># 输出出现频度最高的三个单词</span></span><br><span class="line"><span class="comment"># Out[8]: [(3, 3), (4, 3), (7, 3)]</span></span><br></pre></td></tr></table></figure>

<h2 id="如何快速找到多个字典中的公共键"><a href="#如何快速找到多个字典中的公共键" class="headerlink" title="如何快速找到多个字典中的公共键"></a>如何快速找到多个字典中的公共键</h2><ul>
<li>使用字典的 viewkeys 方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint, sample</span><br><span class="line">s1 = &#123;x: randint(<span class="number">1</span>,<span class="number">4</span>) <span class="keyword">for</span> x <span class="keyword">in</span> sample(<span class="string">&#x27;abcdefg&#x27;</span>, randint(<span class="number">3</span>,<span class="number">6</span>))&#125;</span><br><span class="line">s2 = &#123;x: randint(<span class="number">1</span>,<span class="number">4</span>) <span class="keyword">for</span> x <span class="keyword">in</span> sample(<span class="string">&#x27;abcdefg&#x27;</span>, randint(<span class="number">3</span>,<span class="number">6</span>))&#125;</span><br><span class="line"><span class="comment"># 取交集</span></span><br><span class="line">s2.viewkeys() &amp; s1.viewkeys()</span><br><span class="line"><span class="comment"># map, reduce</span></span><br><span class="line">reduce(<span class="keyword">lambda</span> a, b: a &amp; b, <span class="built_in">map</span>(<span class="built_in">dict</span>.viewkeys, [s1, s2]))</span><br></pre></td></tr></table></figure>

<h2 id="如何让字典保持有序"><a href="#如何让字典保持有序" class="headerlink" title="如何让字典保持有序"></a>如何让字典保持有序</h2><p>问题：按照创建元素的顺序创建字典</p>
<ul>
<li>使用 collections 下的 OrderedDict</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一个简单的竞赛排名系统</span></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line">d = OrderedDict()</span><br><span class="line">players = <span class="built_in">list</span>(<span class="string">&#x27;ABCDEFGH&#x27;</span>)</span><br><span class="line">start = time()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">8</span>):</span><br><span class="line">    raw_input()</span><br><span class="line">    p = players.pop(randint(<span class="number">0</span>, <span class="number">7</span> - i))</span><br><span class="line">    end = time()</span><br><span class="line">    <span class="built_in">print</span> i + <span class="number">1</span>, p, end - start</span><br><span class="line">    d[p] = (i + <span class="number">1</span>, end - start)</span><br><span class="line"><span class="built_in">print</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27; &#x27;</span> * <span class="number">20</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> d:</span><br><span class="line">    <span class="built_in">print</span> k, d[k]</span><br></pre></td></tr></table></figure>

<h2 id="如何实现用户的历史记录功能（最多-n-条）"><a href="#如何实现用户的历史记录功能（最多-n-条）" class="headerlink" title="如何实现用户的历史记录功能（最多 n 条）"></a>如何实现用户的历史记录功能（最多 n 条）</h2><ul>
<li>使用 collections 中的 deque（双端循环队列）实现</li>
<li>使用 pickle 序列化保存数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line">N = randint(<span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line">history = deque([], <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">guess_digit</span>(<span class="params">k</span>):</span></span><br><span class="line">    <span class="keyword">if</span> k == N:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;right&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> k &lt; N:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;%s is less than N&#x27;</span> % k</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;%s is greater than N&#x27;</span> % k</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    line = raw_input(<span class="string">&#x27;please input a number&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> line.isdigit():</span><br><span class="line">        k = <span class="built_in">int</span>(line)</span><br><span class="line">        history.append(k)</span><br><span class="line">        <span class="keyword">if</span> guess_digit(k):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">elif</span> line == <span class="string">&#x27;history&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="built_in">list</span>(history)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 pickle 序列化对象</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line">pickle.dump(history,<span class="built_in">open</span>(<span class="string">&#x27;history&#x27;</span>,<span class="string">&#x27;w&#x27;</span>))</span><br><span class="line">pickle.load(<span class="string">&#x27;history&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="迭代器与生成器"><a href="#迭代器与生成器" class="headerlink" title="迭代器与生成器"></a>迭代器与生成器</h1><p>参考：<a target="_blank" rel="noopener" href="https://nvie.com/posts/iterators-vs-generators/">https://nvie.com/posts/iterators-vs-generators/</a></p>
<p><img src="http://ww1.sinaimg.cn/large/c552abe7gy1ft9cg3hxzvj20zc0fyjrr.jpg"></p>
<p>可迭代对象需要通过 iter () 方法实现为迭代器，然后才能通过 next() 迭代。</p>
<p>生成器是特殊（优雅）的迭代器（通过 yield 方法实现迭代器）。</p>
<p>一句话就是，只有迭代器对象才可以迭代，可迭代对象的意思就是可以实现为迭代器对象，然后迭代，生成器就是迭代器。</p>
<h2 id="如何实现可迭代对象和迭代器对象"><a href="#如何实现可迭代对象和迭代器对象" class="headerlink" title="如何实现可迭代对象和迭代器对象"></a>如何实现可迭代对象和迭代器对象</h2><p>可迭代对象接口：__iter__()，__getitem__()，__next__()</p>
<p>迭代器对象接口：next()</p>
<ul>
<li>实现一个迭代器对象，next() 方法</li>
<li>实现一个可迭代对象，__iter__() 方法返回一个迭代器对象</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Iterable, Iterator</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeatherIterator</span>(<span class="params">Iterator</span>):</span>  <span class="comment"># 迭代器对象</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, cities</span>):</span></span><br><span class="line">        self.cities = cities</span><br><span class="line">        self.index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_weather</span>(<span class="params">self, city</span>):</span></span><br><span class="line">        r = requests.get(<span class="string">u&#x27;http://wthrcdn.etouch.cn/weather_mini?city=&#x27;</span> + city)</span><br><span class="line">        data = r.json()[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;forecast&#x27;</span>][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;%s: %s, %s &#x27;</span> % (city, data[<span class="string">&#x27;low&#x27;</span>], data[<span class="string">&#x27;high&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.index == <span class="built_in">len</span>(self.cities):</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        city = self.cities[self.index]</span><br><span class="line">        self.index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self.get_weather(city)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeatherIterable</span>(<span class="params">Iterable</span>):</span>  <span class="comment"># 可迭代对象</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, cities</span>):</span></span><br><span class="line">        self.cities = cities</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> WeatherIterator(self.cities)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> WeatherIterable([<span class="string">u&#x27;北京&#x27;</span>, <span class="string">u&#x27;上海&#x27;</span>]):</span><br><span class="line">    <span class="built_in">print</span> x</span><br></pre></td></tr></table></figure>

<h2 id="如何使用生成器函数实现可迭代对象"><a href="#如何使用生成器函数实现可迭代对象" class="headerlink" title="如何使用生成器函数实现可迭代对象"></a>如何使用生成器函数实现可迭代对象</h2><ul>
<li>将 __iter__() 方法实现为 yield() 函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrimeNumbers</span>:</span>  <span class="comment"># 生成器实现可迭代对象</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, start, end</span>):</span></span><br><span class="line">        self.start = start</span><br><span class="line">        self.end = end</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_primenum</span>(<span class="params">self, k</span>):</span></span><br><span class="line">        <span class="keyword">if</span> k &lt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">2</span>, k):</span><br><span class="line">            <span class="keyword">if</span> k % i == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> xrange(self.start, self.end + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> self.is_primenum(k):</span><br><span class="line">                <span class="keyword">yield</span> k</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> PrimeNumbers(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    <span class="built_in">print</span> x</span><br></pre></td></tr></table></figure>

<h2 id="如何进行反向迭代以及如何实现反向迭代"><a href="#如何进行反向迭代以及如何实现反向迭代" class="headerlink" title="如何进行反向迭代以及如何实现反向迭代"></a>如何进行反向迭代以及如何实现反向迭代</h2><p>问题：实现一个浮点数发生器，根据范围和步长迭代</p>
<ul>
<li>使用 reversed() 方法</li>
</ul>
<p>引子：如何将列表反向？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">l.reverse()  <span class="comment"># 改变了原列表</span></span><br><span class="line">l[::-<span class="number">1</span>]  <span class="comment"># 得到了一个新列表</span></span><br><span class="line"><span class="built_in">reversed</span>(l)  <span class="comment"># 反向迭代器</span></span><br><span class="line"><span class="built_in">iter</span>(l)  <span class="comment"># 正向迭代器</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FloatFange</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, start, end, step=<span class="number">0.1</span></span>):</span></span><br><span class="line">        self.start = start</span><br><span class="line">        self.end = end</span><br><span class="line">        self.step = step</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        t = self.start</span><br><span class="line">        <span class="keyword">while</span> t &lt;= self.end:</span><br><span class="line">            <span class="keyword">yield</span> t</span><br><span class="line">            t += self.step</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reversed__</span>(<span class="params">self</span>):</span></span><br><span class="line">        t = self.end</span><br><span class="line">        <span class="keyword">while</span> t &gt;= self.start:</span><br><span class="line">            <span class="keyword">yield</span> t</span><br><span class="line">            t -= self.step</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">reversed</span>(FloatFange(<span class="number">2</span>, <span class="number">4</span>)):  <span class="comment"># 反向迭代器</span></span><br><span class="line">    <span class="built_in">print</span> x</span><br></pre></td></tr></table></figure>

<h2 id="如何对迭代器做切片操作"><a href="#如何对迭代器做切片操作" class="headerlink" title="如何对迭代器做切片操作"></a>如何对迭代器做切片操作</h2><p>问题：有某个文本文件，我们想读取其中某范围的内容，如 100-300 行的内容</p>
<ul>
<li>使用标准库中的 itertools.islice，它能返回一个迭代对象切片的生成器</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> islice</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">islice(f, <span class="number">100</span>, <span class="number">300</span>)  <span class="comment"># 100-300 行</span></span><br><span class="line">islice(f, <span class="number">500</span>)  <span class="comment"># 前 500 行</span></span><br><span class="line">islice(f, <span class="number">100</span>, <span class="literal">None</span>)  <span class="comment"># 100 行到最后</span></span><br><span class="line"><span class="comment"># islice 会消耗迭代对象。也就是其实是都迭代了，但是只不过把不符合要求的抛弃了</span></span><br></pre></td></tr></table></figure>

<h2 id="如何在一个-for-语句中迭代多个可迭代对象"><a href="#如何在一个-for-语句中迭代多个可迭代对象" class="headerlink" title="如何在一个 for 语句中迭代多个可迭代对象"></a>如何在一个 for 语句中迭代多个可迭代对象</h2><p>问题：</p>
<ul>
<li>例如有两科成绩，想要算出总成绩</li>
<li>例如有三个班的成绩，想要找出大于 90 分的成绩</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"></span><br><span class="line">math = [randint(<span class="number">0</span>, <span class="number">100</span>) <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">40</span>)]</span><br><span class="line"></span><br><span class="line">english = [randint(<span class="number">0</span>, <span class="number">100</span>) <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">40</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> m, e <span class="keyword">in</span> <span class="built_in">zip</span>(math, english):  <span class="comment"># zip 函数可以迭代多个对象</span></span><br><span class="line">    <span class="built_in">sum</span> = m + e</span><br><span class="line">    <span class="comment"># print sum</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> chain(math,english):  <span class="comment"># chain 函数可以将多个串联起来</span></span><br><span class="line">    <span class="keyword">if</span> s &gt; <span class="number">90</span>:</span><br><span class="line">        <span class="built_in">print</span> s</span><br></pre></td></tr></table></figure>

<h1 id="字符串处理"><a href="#字符串处理" class="headerlink" title="字符串处理"></a>字符串处理</h1><h2 id="如何拆分含有多种分隔符的字符串"><a href="#如何拆分含有多种分隔符的字符串" class="headerlink" title="如何拆分含有多种分隔符的字符串"></a>如何拆分含有多种分隔符的字符串</h2><p>问题：s = ‘ab;cd,|enf|def,kdjk;kdjfk\dd’ 有多种分隔符，如何处理</p>
<ul>
<li>连续使用 str.split() 方法，每次处理一种分隔符</li>
<li>使用正则表达式的 re.split() 方法，一次性拆分字符串</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;ab;cd,|enf|def,kdjk;kdjfk sd&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_split</span>(<span class="params">s, ds</span>):</span>  <span class="comment"># 字符串原始的分隔方法，需要循环</span></span><br><span class="line">    res = [s]</span><br><span class="line">    <span class="built_in">print</span> res</span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> ds:</span><br><span class="line">        t = []</span><br><span class="line">        <span class="built_in">map</span>(<span class="keyword">lambda</span> x: t.extend(x.split(d)), res)</span><br><span class="line">        res = t</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [x <span class="keyword">for</span> x <span class="keyword">in</span> res <span class="keyword">if</span> x]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> my_split(s, <span class="string">&#x27;;, |&#x27;</span>)</span><br><span class="line"></span><br><span class="line">split_pattern = <span class="string">&#x27;[,; |]&#x27;</span>  <span class="comment"># 使用正则表达式来分隔</span></span><br><span class="line"><span class="built_in">print</span> [x <span class="keyword">for</span> x <span class="keyword">in</span> re.split(split_pattern,s) <span class="keyword">if</span> x]</span><br></pre></td></tr></table></figure>

<h2 id="如何判断字符串-a-是否以字符串-b-开头或者结尾"><a href="#如何判断字符串-a-是否以字符串-b-开头或者结尾" class="headerlink" title="如何判断字符串 a 是否以字符串 b 开头或者结尾"></a>如何判断字符串 a 是否以字符串 b 开头或者结尾</h2><p>问题：某文件目录下有一系列文件，例如 .c，.py，.js</p>
<ul>
<li>使用 str.startwith()，str.endwith()，如果有多个结尾的话，需要用元组传入进去</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, stat</span><br><span class="line"></span><br><span class="line">[name <span class="keyword">for</span> name <span class="keyword">in</span> os.listdir(<span class="string">&#x27;.&#x27;</span>) <span class="keyword">if</span> name.endswith((<span class="string">&#x27;.sh&#x27;</span>, <span class="string">&#x27;.py&#x27;</span>))]</span><br><span class="line"></span><br><span class="line">os.stat(<span class="string">&#x27;e.py&#x27;</span>).st_mode  <span class="comment"># 获取用户权限</span></span><br><span class="line">stat.S_IXUSR  <span class="comment"># 用户权限</span></span><br><span class="line"></span><br><span class="line">os.chmod(<span class="string">&#x27;e.py&#x27;</span>, os.stat(<span class="string">&#x27;e.py&#x27;</span>).st_mode | stat.S_IXUSR)  <span class="comment"># 修改文件权限</span></span><br></pre></td></tr></table></figure>

<h2 id="如何调整字符串中文本的格式"><a href="#如何调整字符串中文本的格式" class="headerlink" title="如何调整字符串中文本的格式"></a>如何调整字符串中文本的格式</h2><p>问题：例如需要更改 log 文件中的日期表示形式</p>
<ul>
<li>使用正则表达式 re.sub() 方法做字符串替换，利用正则表达式的捕获组，捕获每个部分的内容，在替换字符串中调整各个捕获组的顺序</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">re.sub(<span class="string">&#x27;(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)&#x27;</span>, <span class="string">r&#x27;\2/\3/\1&#x27;</span>, file)  <span class="comment"># 将某一个日志文件中的日期格式修改，1，2，3 代表捕获组的序号</span></span><br><span class="line">re.sub(<span class="string">&#x27;(?P&lt;year&gt;\d&#123;4&#125;)-(?P&lt;month&gt;\d&#123;2&#125;)-(?P&lt;day&gt;\d&#123;2&#125;)&#x27;</span>, <span class="string">r&#x27;\g&lt;month&gt;/\g&lt;day&gt;/\g&lt;year&gt;&#x27;</span>, file)  <span class="comment"># 第二种方式</span></span><br></pre></td></tr></table></figure>

<h2 id="如何将多个小字符串拼接成一个大的字符串"><a href="#如何将多个小字符串拼接成一个大的字符串" class="headerlink" title="如何将多个小字符串拼接成一个大的字符串"></a>如何将多个小字符串拼接成一个大的字符串</h2><p>问题：</p>
<p><img src="http://ww1.sinaimg.cn/large/c552abe7gy1ft9iukol7tj20qs0ek7di.jpg"></p>
<ul>
<li>迭代列表，使用 + 拼接字符串。（有巨大的开销浪费，拼接过的字符串只是一个临时的）</li>
<li>使用 join 方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">s1 = <span class="string">&#x27;ddjfaljfl;&#x27;</span></span><br><span class="line">s2 = <span class="string">&#x27;ddj1222&#x27;</span></span><br><span class="line"></span><br><span class="line">s1 + s2  <span class="comment"># 运算符重载 + == __add__</span></span><br><span class="line"></span><br><span class="line">l = [<span class="string">&#x27;dd&#x27;</span>, <span class="string">&#x27;kjdlaj&#x27;</span>, <span class="string">&#x27;kke&#x27;</span>]</span><br><span class="line">l2 = <span class="string">&#x27;&#x27;</span>.join(l)</span><br><span class="line">l1 = [<span class="string">&#x27;dd&#x27;</span>, <span class="number">123</span>, <span class="string">&#x27;dd&#x27;</span>, <span class="number">45</span>]</span><br><span class="line"><span class="built_in">print</span> [<span class="string">&#x27;dd&#x27;</span>, <span class="string">&#x27;kjdlaj&#x27;</span>, <span class="string">&#x27;kke&#x27;</span>]</span><br><span class="line">l3 = [<span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> l1]  <span class="comment"># 如果列表很长，开销巨大</span></span><br><span class="line">l3 = (<span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> l1)  <span class="comment"># 推荐使用生成器表达式</span></span><br></pre></td></tr></table></figure>

<h2 id="如何对字符串进行左，右，居中对齐"><a href="#如何对字符串进行左，右，居中对齐" class="headerlink" title="如何对字符串进行左，右，居中对齐"></a>如何对字符串进行左，右，居中对齐</h2><p>问题：</p>
<p><img src="http://ww1.sinaimg.cn/large/c552abe7gy1ft9jcq8xbtj20ls0eeadr.jpg"></p>
<ul>
<li>使用字符串的 str.ljust()，str.rjust()，str.center() 对齐</li>
<li>使用 format 方法，传递类似 ‘&lt;20’，’&gt;20’，’^20’ 参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">s.ljust(<span class="number">20</span>)</span><br><span class="line"><span class="comment"># Out[12]: &#x27;abc                 &#x27;</span></span><br><span class="line">s.rjust(<span class="number">20</span>)</span><br><span class="line"><span class="comment"># Out[13]: &#x27;                 abc&#x27;</span></span><br><span class="line">s.center(<span class="number">20</span>)</span><br><span class="line"><span class="comment"># Out[14]: &#x27;        abc         &#x27;</span></span><br><span class="line"><span class="built_in">format</span>(s,<span class="string">&#x27;&lt;20&#x27;</span>)</span><br><span class="line"><span class="comment"># Out[15]: &#x27;abc                 &#x27;</span></span><br><span class="line"><span class="built_in">format</span>(s,<span class="string">&#x27;&gt;20&#x27;</span>)</span><br><span class="line"><span class="comment"># Out[16]: &#x27;                 abc&#x27;</span></span><br><span class="line"><span class="built_in">format</span>(s,<span class="string">&#x27;^20&#x27;</span>)</span><br><span class="line"><span class="comment"># Out[17]: &#x27;        abc         &#x27;</span></span><br><span class="line"></span><br><span class="line">w = <span class="built_in">max</span>(<span class="built_in">map</span>(<span class="built_in">len</span>, d.key()))  <span class="comment"># 找出字典中最长的键</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> d:</span><br><span class="line">    <span class="built_in">print</span> k.ljust(w), <span class="string">&#x27;:&#x27;</span>, d[k]</span><br></pre></td></tr></table></figure>

<h2 id="如何去掉字符串中不需要的字符"><a href="#如何去掉字符串中不需要的字符" class="headerlink" title="如何去掉字符串中不需要的字符"></a>如何去掉字符串中不需要的字符</h2><p><img src="http://ww1.sinaimg.cn/large/c552abe7gy1ft9jodoletj20iq09mgoy.jpg"></p>
<ul>
<li>字符串 strip()，lstrip()，rstrip() 方法取掉字符串两端字符</li>
<li>删除单个固定位置的字符，可以使用切片+拼接的方式</li>
<li>字符串的 replace() 方法或正则表达式 re.sub() 删除任意位置字符</li>
<li>字符串 translate() 方法，可以同时删除多种不同字符</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 去掉字符串两端的字符</span></span><br><span class="line">s = <span class="string">&#x27;   abc    &#x27;</span></span><br><span class="line">s.strip()  <span class="comment"># 空白</span></span><br><span class="line"><span class="comment"># Out[19]: &#x27;abc&#x27;</span></span><br><span class="line">s = <span class="string">&#x27;---dbc+++&#x27;</span></span><br><span class="line">s.strip(<span class="string">&#x27;-+&#x27;</span>)</span><br><span class="line"><span class="comment"># Out[21]: &#x27;dbc&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 去掉固定位置字符</span></span><br><span class="line">s = <span class="string">&#x27;dbc:ddd&#x27;</span></span><br><span class="line">s[:<span class="number">3</span>] + s[<span class="number">4</span>:]</span><br><span class="line"><span class="comment"># Out[23]: &#x27;dbcddd&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 去掉任意位置</span></span><br><span class="line">s = <span class="string">&#x27;/4kdlkj/4&#x27;</span></span><br><span class="line">s.replace(<span class="string">&#x27;/4&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># Out[25]: &#x27;kdlkj&#x27;</span></span><br><span class="line"><span class="comment"># 或者用正则表达式的 re.sub</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># translate 方法，unicode 也有一个</span></span><br><span class="line">s = <span class="string">&#x27;abc123456xyz&#x27;</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">string.maketrans(<span class="string">&#x27;abcxyz&#x27;</span>,<span class="string">&#x27;xyzabc&#x27;</span>)  <span class="comment"># 建立映射表</span></span><br><span class="line">s.translate(string.maketrans(<span class="string">&#x27;abcxyz&#x27;</span>,<span class="string">&#x27;xyzabc&#x27;</span>))</span><br><span class="line"><span class="comment"># Out[30]: &#x27;xyz123456abc&#x27;</span></span><br><span class="line">s.translate(<span class="literal">None</span>,<span class="string">&#x27;ax&#x27;</span>) <span class="comment"># 第一个为空，表示删除字符</span></span><br><span class="line"><span class="comment"># Out[33]: &#x27;bc123456yz&#x27;</span></span><br><span class="line"></span><br><span class="line">unicode.translate()  <span class="comment"># 映射表为一个字典</span></span><br></pre></td></tr></table></figure>



<h1 id="文件-I-O-操作"><a href="#文件-I-O-操作" class="headerlink" title="文件 I/O 操作"></a>文件 I/O 操作</h1><h2 id="如何读写文本文件"><a href="#如何读写文本文件" class="headerlink" title="如何读写文本文件"></a>如何读写文本文件</h2><p>关于 python 的编解码，看这一篇就够了：<a target="_blank" rel="noopener" href="https://foofish.net/why-python-encoding-is-tricky.html">https://foofish.net/why-python-encoding-is-tricky.html</a></p>
<p><img src="http://ww1.sinaimg.cn/large/c552abe7gy1ftaekwcoacj20sy0gmk3l.jpg"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">u&#x27;你好&#x27;</span></span><br><span class="line"><span class="comment"># python 2</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;filename&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f.write(s.encode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># 写入</span></span><br><span class="line">f.read().decode(<span class="string">&#x27;utf-8&#x27;</span>)  <span class="comment"># 读取</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># python 3</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;filename&#x27;</span>,<span class="string">&#x27;rt&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="comment"># t 指定文本模式</span></span><br><span class="line">f.write(s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tips</span></span><br><span class="line"><span class="comment"># 如果一次性读完了所有文件，需要使用</span></span><br><span class="line">f.seek(<span class="number">0</span>) <span class="comment"># 回到开头</span></span><br></pre></td></tr></table></figure>

<h2 id="如何处理二进制文件"><a href="#如何处理二进制文件" class="headerlink" title="如何处理二进制文件"></a>如何处理二进制文件</h2><p>二进制文件，例如：视频，图片，录音等。</p>
<p><strong>大小端字节</strong></p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hnlyyk/article/details/52541923">https://blog.csdn.net/hnlyyk/article/details/52541923</a></p>
<p>大端：低地址存放高字节位</p>
<p>小端：低地址存放低字节位</p>
<ul>
<li>open 函数指定模式 ‘b’ 打开文件</li>
<li>二进制数据可以用 readinto，读入到提前分配好的 buffer 中</li>
<li>解析二进制数据可以使用标准库中的 struct 模块的 unpack 方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> array</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;demo.wav&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">struct.unpack(<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;\x01\02&#x27;</span>)  <span class="comment"># 小端存储，h 表示 short</span></span><br><span class="line">struct.unpack(<span class="string">&#x27;&gt;h&#x27;</span>,<span class="string">&#x27;\x01\02&#x27;</span>)  <span class="comment"># 大端存储</span></span><br><span class="line">f.seek(<span class="number">0</span>,<span class="number">2</span>)  <span class="comment"># 将文件指针移到末尾</span></span><br><span class="line">f.tell()</span><br><span class="line">n = (f.tell() - <span class="number">44</span>)/<span class="number">2</span></span><br><span class="line">buff = array.array(<span class="string">&#x27;h&#x27;</span>,(<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> xrange(n)))  <span class="comment"># 创建数组</span></span><br></pre></td></tr></table></figure>

<h2 id="如何设置文件的缓冲"><a href="#如何设置文件的缓冲" class="headerlink" title="如何设置文件的缓冲"></a>如何设置文件的缓冲</h2><p>问题：<img src="http://ww1.sinaimg.cn/large/c552abe7gy1ftfhmfe084j20oy09a7bg.jpg"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;demo.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,buffering=<span class="number">2048</span>)  <span class="comment"># 全缓冲，默认 4096B</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;demo.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,buffering=<span class="number">1</span>)  <span class="comment"># 行缓冲，遇到换行符就写入一次</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;demo.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,buffering=<span class="number">0</span>)  <span class="comment"># 无缓冲</span></span><br></pre></td></tr></table></figure>

<h2 id="如何将文件映射到内存"><a href="#如何将文件映射到内存" class="headerlink" title="如何将文件映射到内存"></a>如何将文件映射到内存</h2><p><img src="http://ww1.sinaimg.cn/large/c552abe7gy1ftfhw3rum3j20tq0a8ai2.jpg"></p>
<ul>
<li>使用标准库中的 mmap 模块的 mmap() 函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mmap</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;demo.bin&#x27;</span>, <span class="string">&#x27;r+b&#x27;</span>)</span><br><span class="line">f.fileno()  <span class="comment"># 文件描述符</span></span><br><span class="line">m = mmap.mmap(f.fileno(), <span class="number">0</span>, access=mmap.ACCESS_WRITE)</span><br><span class="line">m[<span class="number">0</span>]  <span class="comment"># 索引</span></span><br><span class="line">m[<span class="number">10</span>:<span class="number">20</span>]  <span class="comment"># 切片</span></span><br><span class="line">m[<span class="number">0</span>] = <span class="string">&#x27;\x88&#x27;</span>  <span class="comment"># 修改文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  mmap(fileno, length[, flags[, prot[, access[, offset]]]])</span></span><br><span class="line"></span><br><span class="line">mmap.mmap(f.fileno(), mmap.PAGESIZE * <span class="number">8</span>, access=mmap.ACCESS_WRITE,offset=mmap.PAGESIZE*<span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<h2 id="如何访问文件的状态"><a href="#如何访问文件的状态" class="headerlink" title="如何访问文件的状态"></a>如何访问文件的状态</h2><p><img src="http://ww1.sinaimg.cn/large/c552abe7gy1ftgmrqh1d0j20pq09egri.jpg"></p>
<ul>
<li>系统调用：os, stat 模块</li>
<li>os.path 下的函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, stat</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"></span><br><span class="line">s = os.stat(<span class="string">&#x27;filename&#x27;</span>)  <span class="comment"># 跟随符号链接，指向原始文件</span></span><br><span class="line">s</span><br><span class="line">Out[<span class="number">8</span>]: posix.stat_result(st_mode=<span class="number">33188</span>, st_ino=<span class="number">2373061</span>, st_dev=<span class="number">16777217</span>, st_nlink=<span class="number">1</span>, st_uid=<span class="number">501</span>, st_gid=<span class="number">20</span>, st_size=<span class="number">2064</span>, st_atime=<span class="number">1530613571</span>, st_mtime=<span class="number">1530613571</span>, st_ctime=<span class="number">1530613571</span>)</span><br><span class="line"></span><br><span class="line">os.lstat(<span class="string">&#x27;filename&#x27;</span>)  <span class="comment"># 不跟随符号链接</span></span><br><span class="line">os.fstat(<span class="string">&#x27;filename&#x27;</span>)  <span class="comment"># 打开的是文件描述符</span></span><br><span class="line">stat.S_ISDIR(s.st_mode)</span><br><span class="line"></span><br><span class="line"><span class="comment"># os.path</span></span><br><span class="line">os.path.isdir()</span><br><span class="line">os.path.islink()</span><br></pre></td></tr></table></figure>

<h2 id="如何使用临时文件"><a href="#如何使用临时文件" class="headerlink" title="如何使用临时文件"></a>如何使用临时文件</h2><p><img src="http://ww1.sinaimg.cn/large/c552abe7gy1ftgn6xcmezj20q009i7b9.jpg"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tempfile <span class="keyword">import</span> TemporaryFile, NamedTemporaryFile</span><br><span class="line">f = TemporaryFile()  <span class="comment"># 在文件系统中找不到</span></span><br><span class="line">f.write(<span class="string">&#x27;abcdef&#x27;</span>*<span class="number">1000000</span>)</span><br><span class="line">f.seek(<span class="number">0</span>)</span><br><span class="line">f.read(<span class="number">100</span>)</span><br><span class="line"><span class="comment"># Out[15]: &#x27;abcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcd&#x27;</span></span><br><span class="line">ntf = NamedTemporaryFile()  <span class="comment"># 可以得到临时文件的路径，可以多个进程访问</span></span><br><span class="line">ntf.name</span><br><span class="line">Out[<span class="number">17</span>]: <span class="string">&#x27;/var/folders/6t/b8j3jt1x3nl5bp70ll6fmqfh0000gn/T/tmpa6DRYC&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="数据编码与处理"><a href="#数据编码与处理" class="headerlink" title="数据编码与处理"></a>数据编码与处理</h1><h2 id="如何读写-csv-数据"><a href="#如何读写-csv-数据" class="headerlink" title="如何读写 csv 数据"></a>如何读写 csv 数据</h2><ul>
<li>使用标准库 csv 模块，可以使用其中 reader 和 writer 完成 csv 文件读写</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line">rf = <span class="built_in">open</span>(<span class="string">&#x27;pingan.csv&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">reader = csv.reader(rf)</span><br><span class="line">wf = <span class="built_in">open</span>(<span class="string">&#x27;pingan.csv&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">writer = csv.writer(wf)</span><br><span class="line">writer.writewrow()  <span class="comment"># 按行写</span></span><br></pre></td></tr></table></figure>

<h2 id="如何读写-json-数据"><a href="#如何读写-json-数据" class="headerlink" title="如何读写 json 数据"></a>如何读写 json 数据</h2><ul>
<li>使用标准库中的 json 模块，其中 loads，dumps 函数可以完成 json 数据的读写</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> record <span class="keyword">import</span> Record  <span class="comment"># 录音模块</span></span><br><span class="line">record = Record(channels=<span class="number">1</span>)</span><br><span class="line">audioData = record.record(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">l = [<span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;abc&#x27;</span>, &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;bpb&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="string">&#x27;ddd&#x27;</span>&#125;]</span><br><span class="line">s = json.dumps(l,separators=[<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;:&#x27;</span>])</span><br><span class="line"><span class="comment"># Out[9]: &#x27;[1,2,&quot;abc&quot;,&#123;&quot;age&quot;:&quot;ddd&quot;,&quot;name&quot;:&quot;bpb&quot;&#125;]&#x27;</span></span><br><span class="line">json.dumps(d, sort_keys=<span class="literal">True</span>)</span><br><span class="line">json.loads(s)</span><br><span class="line"><span class="comment"># 文件</span></span><br><span class="line">json.dump()  <span class="comment"># 写入到文件</span></span><br><span class="line">json.load()  <span class="comment"># 从文件导入</span></span><br></pre></td></tr></table></figure>

<h2 id="如何解析简单的-xml-文档"><a href="#如何解析简单的-xml-文档" class="headerlink" title="如何解析简单的 xml 文档"></a>如何解析简单的 xml 文档</h2><ul>
<li>使用标准库中的 xml 模块</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree</span><br><span class="line"><span class="comment"># 与 xpath 表达式类似</span></span><br></pre></td></tr></table></figure>

<h2 id="如何构建-xml-文档"><a href="#如何构建-xml-文档" class="headerlink" title="如何构建 xml 文档"></a>如何构建 xml 文档</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> Element, ElementTree</span><br><span class="line">e = Element(<span class="string">&#x27;Data&#x27;</span>)</span><br><span class="line">e.tag</span><br><span class="line">Out[<span class="number">21</span>]: <span class="string">&#x27;Data&#x27;</span></span><br><span class="line">e.<span class="built_in">set</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>)</span><br><span class="line"><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> Element, ElementTree, tostring</span><br><span class="line">tostring(e)</span><br><span class="line">Out[<span class="number">24</span>]: <span class="string">&#x27;&lt;Data name=&quot;abc&quot; /&gt;&#x27;</span></span><br><span class="line">e.text = <span class="string">&#x27;123&#x27;</span></span><br><span class="line">tostring(e)</span><br><span class="line">Out[<span class="number">26</span>]: <span class="string">&#x27;&lt;Data name=&quot;abc&quot;&gt;123&lt;/Data&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> Element, ElementTree</span><br><span class="line"><span class="keyword">from</span> e2 <span class="keyword">import</span> pretty  <span class="comment"># 美化格式的小函数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">csvToXml</span>(<span class="params">fname</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(fname, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        reader = csv.reader(f)</span><br><span class="line">        headers = reader.<span class="built_in">next</span>()</span><br><span class="line"></span><br><span class="line">        root = Element(<span class="string">&#x27;Data&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">            eRow = Element(<span class="string">&#x27;Row&#x27;</span>)</span><br><span class="line">            root.append(eRow)</span><br><span class="line">            <span class="keyword">for</span> tag, text <span class="keyword">in</span> <span class="built_in">zip</span>(headers, row):</span><br><span class="line">                e = Element(tag)</span><br><span class="line">                e.text = text</span><br><span class="line">                eRow.append(e)</span><br><span class="line"></span><br><span class="line">    pretty(root)</span><br><span class="line">    <span class="keyword">return</span> ElementTree(root)</span><br><span class="line"></span><br><span class="line">et = csvToXml(<span class="string">&#x27;pingan.csv&#x27;</span>)</span><br><span class="line">et.write(<span class="string">&#x27;pingan.xml&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="如何读写-excel-文件"><a href="#如何读写-excel-文件" class="headerlink" title="如何读写 excel 文件"></a>如何读写 excel 文件</h2><ul>
<li>使用 xlrd 和 xlwt（不好用）</li>
</ul>
<h1 id="类与对象"><a href="#类与对象" class="headerlink" title="类与对象"></a>类与对象</h1><h2 id="如何派生内置不可变类型并修改实例化行为"><a href="#如何派生内置不可变类型并修改实例化行为" class="headerlink" title="如何派生内置不可变类型并修改实例化行为"></a>如何派生内置不可变类型并修改实例化行为</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IntTuple</span>(<span class="params"><span class="built_in">tuple</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, iterable</span>):</span></span><br><span class="line">        g = (x <span class="keyword">for</span> x <span class="keyword">in</span> iterable <span class="keyword">if</span> <span class="built_in">isinstance</span>(x, <span class="built_in">int</span>) <span class="keyword">and</span> x &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>(IntTuple, cls).__new__(cls, g)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, iterable</span>):</span></span><br><span class="line">        <span class="comment"># before</span></span><br><span class="line">        <span class="built_in">print</span> self</span><br><span class="line">        <span class="built_in">super</span>(IntTuple, self).__init__(iterable)</span><br><span class="line">        <span class="comment"># after</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t = IntTuple([<span class="number">1</span>, -<span class="number">1</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="number">6</span>, [<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>], <span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span> t</span><br></pre></td></tr></table></figure>

<h2 id="如何为创建大量实例节省内存"><a href="#如何为创建大量实例节省内存" class="headerlink" title="如何为创建大量实例节省内存"></a>如何为创建大量实例节省内存</h2><ul>
<li>定义类的 __slots__ 属性，用来声明实例属性名字的列表</li>
</ul>
<p>普通的实例创建完成之后，会有一个 __dict__ 方法，这个方法可以动态绑定实例，但是也造成了很大的内存开销，所以可以通过 __slot__ 属性，阻止动态绑定实例</p>
<h2 id="如何让对象支持上下文管理器"><a href="#如何让对象支持上下文管理器" class="headerlink" title="如何让对象支持上下文管理器"></a>如何让对象支持上下文管理器</h2><ul>
<li>实现上下文管理协议，需要定义实例的 __enter__, __exit__ 方法，它们分别在 with 开始和结束时被调用</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在类中实现</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__enter</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">    <span class="comment"># 需要返回值 作为 with .. as .. 的对象</span></span><br><span class="line">    <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span></span><br><span class="line">    <span class="comment"># 关闭实例</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span>  <span class="comment"># 则不会抛出异常</span></span><br><span class="line"><span class="comment"># 例子</span></span><br><span class="line"><span class="keyword">from</span> telnetlib <span class="keyword">import</span> Telnet</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> stdin, stdout</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TelnetClient</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, addr, port=<span class="number">23</span></span>):</span></span><br><span class="line">        self.addr = addr</span><br><span class="line">        self.port = port</span><br><span class="line">        self.tn = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Test&#x27;</span>)</span><br><span class="line">        <span class="comment"># user</span></span><br><span class="line">        t = self.tn.read_until(<span class="string">&#x27;login: &#x27;</span>)</span><br><span class="line">        stdout.write(t)</span><br><span class="line">        user = stdin.readline()</span><br><span class="line">        self.tn.write(user)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># password</span></span><br><span class="line">        t = self.tn.read_until(<span class="string">&#x27;Password: &#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> t.startswith(user[:-<span class="number">1</span>]): t = t[<span class="built_in">len</span>(user) + <span class="number">1</span>:]</span><br><span class="line">        stdout.write(t)</span><br><span class="line">        self.tn.write(stdin.readline())</span><br><span class="line"></span><br><span class="line">        t = self.tn.read_until(<span class="string">&#x27;$ &#x27;</span>)</span><br><span class="line">        stdout.write(t)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            uinput = stdin.readline()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> uinput:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            self.history.append(uinput)</span><br><span class="line">            self.tn.write(uinput)</span><br><span class="line">            t = self.tn.read_until(<span class="string">&#x27;$ &#x27;</span>)</span><br><span class="line">            stdout.write(t[<span class="built_in">len</span>(uinput) + <span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cleanup</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.tn = Telnet(self.addr, self.port)</span><br><span class="line">        self.history = deque()</span><br><span class="line">        <span class="keyword">return</span> self </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;In __exit__&#x27;</span></span><br><span class="line"></span><br><span class="line">        self.tn.close()</span><br><span class="line">        self.tn = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(self.addr + <span class="string">&#x27;_history.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.writelines(self.history)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> TelnetClient(<span class="string">&#x27;127.0.0.1&#x27;</span>) <span class="keyword">as</span> client:</span><br><span class="line">    client.start()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;END&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">client = TelnetClient(&#x27;127.0.0.1&#x27;) </span></span><br><span class="line"><span class="string">print &#x27;\nstart...&#x27;</span></span><br><span class="line"><span class="string">client.start()</span></span><br><span class="line"><span class="string">print &#x27;\ncleanup&#x27;</span></span><br><span class="line"><span class="string">client.cleanup()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="如何创建可管理的对象属性"><a href="#如何创建可管理的对象属性" class="headerlink" title="如何创建可管理的对象属性"></a>如何创建可管理的对象属性</h2><p>问题：不想让用户通过属性来管理，形式上是使用属性访问，实际上调用方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> pi</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, radius</span>):</span></span><br><span class="line">        self.radius = radius</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getRadius</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.radius</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setRadius</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, (<span class="built_in">int</span>, long, <span class="built_in">float</span>)):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;wrong type.&#x27;</span>)</span><br><span class="line">        self.radius = <span class="built_in">float</span>(value)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getArea</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.radius ** <span class="number">2</span> * pi</span><br><span class="line">    R = <span class="built_in">property</span>(getRadius, setRadius)  <span class="comment"># get 方法，set 方法</span></span><br><span class="line"></span><br><span class="line">c = Circle(<span class="number">3.2</span>)</span><br><span class="line">c.R</span><br><span class="line">c.R = <span class="number">23</span></span><br><span class="line"><span class="built_in">print</span> c.R</span><br></pre></td></tr></table></figure>

<h2 id="如何让类支持比较操作"><a href="#如何让类支持比较操作" class="headerlink" title="如何让类支持比较操作"></a>如何让类支持比较操作</h2><ul>
<li>比较运算符重载，需要实现以下方法：__lt__, __le__, __gt__, __ge__, __eq__, __ne__</li>
<li>使用标准库下的 functools 下的类装饰器 total_ordering 可以简化此过程</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一种方法，挨个实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, w, h</span>):</span></span><br><span class="line">        self.w = w</span><br><span class="line">        self.h = h</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">area</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.w * self.h</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;in__lt__&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> self.area() &lt; obj.area()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二种方法</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> total_ordering</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> abstractmethod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@total_ordering  </span><span class="comment"># 实现运算符重载</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">area</span>(<span class="params">self</span>):</span>  <span class="comment"># 抽象接口</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 而实现其他的大于等于，小于等于等的逻辑都是通过小于和等于来实现的，例如，&gt;= 就是 not __lt__</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;in__lt__&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(obj, Shape):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;obj is not shape&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> self.area() &lt; obj.area()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span>(<span class="params">self, obj</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;in__eq__&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(obj, Shape):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;obj is not shape&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> self.area() == obj.area()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span>(<span class="params">Shape</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, w, h</span>):</span></span><br><span class="line">        self.w = w</span><br><span class="line">        self.h = h</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">area</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.w * self.h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span>(<span class="params">Shape</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, r</span>):</span></span><br><span class="line">        self.r = r</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">area</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.r ** <span class="number">2</span> * <span class="number">3.14</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r1 = Rectangle(<span class="number">5</span>, <span class="number">3</span>)</span><br><span class="line">r2 = Circle(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> r1 &lt; r2  <span class="comment">#</span></span><br><span class="line"><span class="built_in">print</span> r2 &lt; r1</span><br></pre></td></tr></table></figure>

<h2 id="如何使用描述符对实例属性做类型检查"><a href="#如何使用描述符对实例属性做类型检查" class="headerlink" title="如何使用描述符对实例属性做类型检查"></a>如何使用描述符对实例属性做类型检查</h2><p>要求：</p>
<ul>
<li>可以指定类型</li>
<li>类型不正确时抛出异常</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Attr</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, type_</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.type_ = type_</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span>(<span class="params">self, instance, cls</span>):</span></span><br><span class="line">        <span class="keyword">return</span> instance.__dict__[self.name]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span>(<span class="params">self, instance, value</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, self.type_):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&#x27;expected an %s&#x27;</span> % self.type_)</span><br><span class="line">        instance.__dict__[self.name] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> AttributeError(<span class="string">&quot;can&#x27;t delete this attr&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    name    = Attr(<span class="string">&#x27;name&#x27;</span>, <span class="built_in">str</span>)</span><br><span class="line">    age     = Attr(<span class="string">&#x27;age&#x27;</span>, <span class="built_in">int</span>) </span><br><span class="line">    height  = Attr(<span class="string">&#x27;height&#x27;</span>, <span class="built_in">float</span>)</span><br><span class="line">    weight  = Attr(<span class="string">&#x27;weight&#x27;</span>, <span class="built_in">float</span>)</span><br><span class="line"></span><br><span class="line">s = Person()</span><br><span class="line">s.name = <span class="string">&#x27;Bob&#x27;</span></span><br><span class="line">s.age = <span class="number">17</span></span><br><span class="line">s.height = <span class="number">1.82</span></span><br><span class="line">s.weight = <span class="number">52.5</span></span><br></pre></td></tr></table></figure>

<h2 id="如何在环状数据结构中管理内存"><a href="#如何在环状数据结构中管理内存" class="headerlink" title="如何在环状数据结构中管理内存"></a>如何在环状数据结构中管理内存</h2><ul>
<li>使用标准库 weakref，它可以创建一种能访问对象但不增加引用计数的对象。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> weakref</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Data</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value, owner</span>):</span></span><br><span class="line">        self.owner = weakref.ref(owner)  <span class="comment"># 弱引用</span></span><br><span class="line">        self.value = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;%s&#x27;s data, value is %s&quot;</span> % (self.owner(), self.value)  <span class="comment"># 引用函数</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;in Data.__del__&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self.data = Data(value, self)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;in Node.__del__&#x27;</span></span><br><span class="line"></span><br><span class="line">node = Node(<span class="number">100</span>)</span><br><span class="line"><span class="keyword">del</span> node</span><br><span class="line">raw_input(<span class="string">&#x27;wait...&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="如何通过实例方法名字的字符串调用方法"><a href="#如何通过实例方法名字的字符串调用方法" class="headerlink" title="如何通过实例方法名字的字符串调用方法"></a>如何通过实例方法名字的字符串调用方法</h2><ul>
<li>使用内置函数 getattr，通过名字在实例上获取方法对象，然后调用</li>
<li>使用标准库 operator 下的 methodcaller 函数调用</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一种方法</span></span><br><span class="line"><span class="keyword">from</span> lib1 <span class="keyword">import</span> Cirle</span><br><span class="line"><span class="keyword">from</span> lib2 <span class="keyword">import</span> Triangle</span><br><span class="line"><span class="keyword">from</span> lib3 <span class="keyword">import</span> Rectangle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getArea</span>(<span class="params">shape</span>):</span></span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> (<span class="string">&#x27;area&#x27;</span>, <span class="string">&#x27;getArea&#x27;</span>, <span class="string">&#x27;get_area&#x27;</span>):</span><br><span class="line">        f = <span class="built_in">getattr</span>(shape, name, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> f:</span><br><span class="line">            <span class="keyword">return</span> f()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">shape1 = Circle(<span class="number">2</span>)</span><br><span class="line">shape2 = Triangle(<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">shape3 = Rectangle(<span class="number">6</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">shapes = [shape1, shape2, shape3]</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">map</span>(getArea, shapes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二种方法</span></span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> methodcaller</span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;abc123abc456&#x27;</span></span><br><span class="line"><span class="built_in">print</span> s.find(<span class="string">&#x27;abc&#x27;</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span> methodcaller(<span class="string">&#x27;find&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="number">4</span>)(s)</span><br></pre></td></tr></table></figure>

<h1 id="多线程与多进程"><a href="#多线程与多进程" class="headerlink" title="多线程与多进程"></a>多线程与多进程</h1><h2 id="如何使用多线程"><a href="#如何使用多线程" class="headerlink" title="如何使用多线程"></a>如何使用多线程</h2><ul>
<li>IO 密集型</li>
<li>CPU 密集型</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span>(<span class="params">Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, sid</span>):</span></span><br><span class="line">        Thread.__init__(self)</span><br><span class="line">        self.sid = sid</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        handle(self.sid)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">threads = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">    t = MyThread(i)</span><br><span class="line">    threads.append(t)</span><br><span class="line">    t.start()</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">    t.join()</span><br></pre></td></tr></table></figure>

<h2 id="如何线程间通信"><a href="#如何线程间通信" class="headerlink" title="如何线程间通信"></a>如何线程间通信</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Queue <span class="keyword">import</span> Queue</span><br></pre></td></tr></table></figure>

<h2 id="如何在线程间进行事件通知"><a href="#如何在线程间进行事件通知" class="headerlink" title="如何在线程间进行事件通知"></a>如何在线程间进行事件通知</h2><ul>
<li>等待事件用 wait</li>
<li>通知事件用 set</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Event, Thread</span><br></pre></td></tr></table></figure>

<h2 id="如何使用线程本地数据"><a href="#如何使用线程本地数据" class="headerlink" title="如何使用线程本地数据"></a>如何使用线程本地数据</h2><h2 id="如何使用线程池"><a href="#如何使用线程池" class="headerlink" title="如何使用线程池"></a>如何使用线程池</h2><h2 id="如何使用多进程"><a href="#如何使用多进程" class="headerlink" title="如何使用多进程"></a>如何使用多进程</h2><h1 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h1><h2 id="如何使用函数装饰器"><a href="#如何使用函数装饰器" class="headerlink" title="如何使用函数装饰器"></a>如何使用函数装饰器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">题目 1 计算斐波那契数列 1，1，2，3，5，8，13</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cache</span>(<span class="params">func</span>):</span></span><br><span class="line">    cache = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrap</span>(<span class="params">*args</span>):</span></span><br><span class="line">        <span class="comment"># print args</span></span><br><span class="line">        <span class="keyword">if</span> args <span class="keyword">not</span> <span class="keyword">in</span> cache:</span><br><span class="line">            cache[args] = func(*args)</span><br><span class="line">        <span class="keyword">return</span> cache[args]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrap</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 常规写法</span></span><br><span class="line"><span class="meta">@cache  </span><span class="comment"># 加装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> fibonacci(n - <span class="number">1</span>) + fibonacci(n - <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加缓存</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci_cache</span>(<span class="params">n, cache=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> cache <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        cache = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> n <span class="keyword">in</span> cache:</span><br><span class="line">        <span class="keyword">return</span> cache[n]</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    cache[n] = fibonacci_cache(n - <span class="number">1</span>, cache) + fibonacci_cache(n - <span class="number">2</span>, cache)</span><br><span class="line">    <span class="keyword">return</span> cache[n]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 题目 2 一个共有 10 个台阶的楼梯，从下面走到上面，一次只能迈 1-3 个台阶，并且不能后退，走完这个楼梯共有多少种方法</span></span><br><span class="line"><span class="meta">@cache</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">climb</span>(<span class="params">n, steps</span>):</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        count = <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> step <span class="keyword">in</span> steps:</span><br><span class="line">            count += climb(n - step, steps)</span><br><span class="line">    <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加缓存</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print fibonacci(50)</span></span><br><span class="line"><span class="comment"># print fibonacci_cache(50)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> climb(<span class="number">20</span>, (<span class="number">1</span>, <span class="number">2</span>,<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<h2 id="如何为被装饰的函数保存元数据"><a href="#如何为被装饰的函数保存元数据" class="headerlink" title="如何为被装饰的函数保存元数据"></a>如何为被装饰的函数保存元数据</h2><p><img src="http://ww1.sinaimg.cn/large/c552abe7gy1ftip0ubmj8j20mg0e2n4j.jpg"></p>
<p>参考：<a target="_blank" rel="noopener" href="https://foofish.net/python-decorator.html">https://foofish.net/python-decorator.html</a></p>
<ul>
<li>functools.wraps</li>
</ul>
<p>使用装饰器极大地复用了代码，但是他有一个缺点就是原函数的元信息不见了，比如函数的<code>docstring</code>、<code>__name__</code>、参数列表，先看例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logged</span>(<span class="params">func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">with_logging</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        <span class="built_in">print</span> func.__name__      <span class="comment"># 输出 &#x27;with_logging&#x27;</span></span><br><span class="line">        <span class="built_in">print</span> func.__doc__       <span class="comment"># 输出 None</span></span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> with_logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数</span></span><br><span class="line"><span class="meta">@logged</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x</span>):</span></span><br><span class="line">   <span class="string">&quot;&quot;&quot;does some math&quot;&quot;&quot;</span></span><br><span class="line">   <span class="keyword">return</span> x + x * x</span><br><span class="line"></span><br><span class="line">logged(f)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logged</span>(<span class="params">func</span>):</span></span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">with_logging</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        <span class="built_in">print</span> func.__name__      <span class="comment"># 输出 &#x27;f&#x27;</span></span><br><span class="line">        <span class="built_in">print</span> func.__doc__       <span class="comment"># 输出 &#x27;does some math&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> with_logging</span><br><span class="line"></span><br><span class="line"><span class="meta">@logged</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x</span>):</span></span><br><span class="line">   <span class="string">&quot;&quot;&quot;does some math&quot;&quot;&quot;</span></span><br><span class="line">   <span class="keyword">return</span> x + x * x</span><br></pre></td></tr></table></figure>

<h2 id="如何定义带参数的装饰器"><a href="#如何定义带参数的装饰器" class="headerlink" title="如何定义带参数的装饰器"></a>如何定义带参数的装饰器</h2><p><img src="http://ww1.sinaimg.cn/large/c552abe7gy1ftip8g7hnmj20xu0kmk3s.jpg"></p>
<h3 id="带参数的装饰器"><a href="#带参数的装饰器" class="headerlink" title="带参数的装饰器"></a>带参数的装饰器</h3><p>装饰器还有更大的灵活性，例如带参数的装饰器，在上面的装饰器调用中，该装饰器接收唯一的参数就是执行业务的函数 foo 。装饰器的语法允许我们在调用时，提供其它参数，比如<code>@decorator(a)</code>。这样，就为装饰器的编写和使用提供了更大的灵活性。比如，我们可以在装饰器中指定日志的等级，因为不同业务函数可能需要的日志级别是不一样的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">use_logging</span>(<span class="params">level</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span>(<span class="params">func</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">            <span class="keyword">if</span> level == <span class="string">&quot;warn&quot;</span>:</span><br><span class="line">                logging.warn(<span class="string">&quot;%s is running&quot;</span> % func.__name__)</span><br><span class="line">            <span class="keyword">elif</span> level == <span class="string">&quot;info&quot;</span>:</span><br><span class="line">                logging.info(<span class="string">&quot;%s is running&quot;</span> % func.__name__)</span><br><span class="line">            <span class="keyword">return</span> func(*args)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@use_logging(<span class="params">level=<span class="string">&quot;warn&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">name=<span class="string">&#x27;foo&#x27;</span></span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;i am %s&quot;</span> % name)</span><br><span class="line"></span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>

<p>上面的 use_logging 是允许带参数的装饰器。它实际上是对原有装饰器的一个函数封装，并返回一个装饰器。我们可以将它理解为一个含有参数的闭包。当我 们使用<code>@use_logging(level=&quot;warn&quot;)</code>调用的时候，Python 能够发现这一层的封装，并把参数传递到装饰器的环境中。</p>
<p><code>@use_logging(level=&quot;warn&quot;)</code>等价于<code>@decorator</code></p>
<h2 id="如何实现属性可修改的装饰器"><a href="#如何实现属性可修改的装饰器" class="headerlink" title="如何实现属性可修改的装饰器"></a>如何实现属性可修改的装饰器</h2><p><img src="http://ww1.sinaimg.cn/large/c552abe7gy1ftipucyfsej20uo0emqd0.jpg"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">import</span> time, logging</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">warn</span>(<span class="params">timeout</span>):</span></span><br><span class="line">    timeout = [timeout]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span>(<span class="params">func</span>):</span></span><br><span class="line"><span class="meta">        @wraps(<span class="params">func</span>)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">            start = time.time()</span><br><span class="line">            res = func(*args, **kwargs)</span><br><span class="line">            used = time.time() - start</span><br><span class="line">            <span class="keyword">if</span> used &gt; timeout[<span class="number">0</span>]:</span><br><span class="line">                msg = <span class="string">&#x27;%s, %s, %s&#x27;</span> % (func.__name__, used, timeout[<span class="number">0</span>])</span><br><span class="line">                logging.warn(msg)</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">setTimeout</span>(<span class="params">k</span>):</span></span><br><span class="line">            <span class="comment">#nonlocal timeout  # python 3 语法</span></span><br><span class="line">            timeout[<span class="number">0</span>] = k</span><br><span class="line"></span><br><span class="line">        wrapper.setTimeout = setTimeout  <span class="comment"># 将setTimeout()函数作为wrapper的属性</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@warn(<span class="params"><span class="number">1.5</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;In test&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> randint(<span class="number">0</span>, <span class="number">1</span>):</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    test()</span><br><span class="line"></span><br><span class="line">test.setTimeout(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    test()</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://iziyang.github.io/2018/07/03/puppet-learn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://s3plus.meituan.net/v1/mss_f32142e8d47149129e9550e929704625/yzz-test-image/qrcode_for_gh_3cfae3cf61d9_1280.jpg">
      <meta itemprop="name" content="原少子杨">
      <meta itemprop="description" content="目前是一名 SRE，爱好 Go 和 Python">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="原少子杨">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/03/puppet-learn/" class="post-title-link" itemprop="url">puppet-learn</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-03 11:59:56" itemprop="dateCreated datePublished" datetime="2018-07-03T11:59:56+08:00">2018-07-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-17 19:59:59" itemprop="dateModified" datetime="2021-05-17T19:59:59+08:00">2021-05-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a>
                </span>
            </span>

          
            <span id="/2018/07/03/puppet-learn/" class="post-meta-item leancloud_visitors" data-flag-title="puppet-learn" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/07/03/puppet-learn/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/07/03/puppet-learn/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="puppet-安装"><a href="#puppet-安装" class="headerlink" title="puppet 安装"></a>puppet 安装</h1><h2 id="master"><a href="#master" class="headerlink" title="master"></a>master</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install puppet puppet-server </span><br></pre></td></tr></table></figure>

<p>puppet 配置</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://iziyang.github.io/2018/06/11/target-offer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://s3plus.meituan.net/v1/mss_f32142e8d47149129e9550e929704625/yzz-test-image/qrcode_for_gh_3cfae3cf61d9_1280.jpg">
      <meta itemprop="name" content="原少子杨">
      <meta itemprop="description" content="目前是一名 SRE，爱好 Go 和 Python">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="原少子杨">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/11/target-offer/" class="post-title-link" itemprop="url">剑指 offer——Python 实现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-11 09:38:24" itemprop="dateCreated datePublished" datetime="2018-06-11T09:38:24+08:00">2018-06-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-17 19:59:59" itemprop="dateModified" datetime="2021-05-17T19:59:59+08:00">2021-05-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a>
                </span>
            </span>

          
            <span id="/2018/06/11/target-offer/" class="post-meta-item leancloud_visitors" data-flag-title="剑指 offer——Python 实现" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/06/11/target-offer/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/06/11/target-offer/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="题-2：单例模式"><a href="#题-2：单例模式" class="headerlink" title="题 2：单例模式"></a>题 2：单例模式</h1><p>python 中的单例模式有四种实现方式：</p>
<ol>
<li>模块</li>
<li>使用 <code>__new__</code> 方法</li>
<li>使用装饰器</li>
<li>使用元类</li>
</ol>
<p>这里解释使用 <code>__new__</code> 方法的实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 单例模式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    _instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(cls._instance, cls):</span><br><span class="line">            <span class="comment"># cls._instance = super(Singleton, cls).__new__(cls, *args, **kwargs)</span></span><br><span class="line">            cls._instance = <span class="built_in">object</span>.__new__(cls, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Myclass</span>(<span class="params">Singleton</span>):</span></span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A = Myclass()</span><br><span class="line">B = Myclass()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">id</span>(A), <span class="built_in">id</span>(B)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="题-3：数组中重复的数字"><a href="#题-3：数组中重复的数字" class="headerlink" title="题 3：数组中重复的数字"></a>题 3：数组中重复的数字</h1><h2 id="1-找出数组中重复的数字"><a href="#1-找出数组中重复的数字" class="headerlink" title="1. 找出数组中重复的数字"></a>1. 找出数组中重复的数字</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="comment"># 这里要特别注意~找到任意重复的一个值并赋值到duplication[0]</span></span><br><span class="line">    <span class="comment"># 函数返回True/False</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">duplicate</span>(<span class="params">self, numbers, duplication</span>):</span></span><br><span class="line">        <span class="keyword">if</span> numbers <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="built_in">len</span>(numbers) &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> numbers:</span><br><span class="line">                <span class="keyword">if</span> i &lt; <span class="number">0</span> <span class="keyword">or</span> i &gt; <span class="built_in">len</span>(numbers) - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(numbers)):</span><br><span class="line">                <span class="keyword">while</span> numbers[i] != i:</span><br><span class="line">                    <span class="keyword">if</span> numbers[i] == numbers[numbers[i]]:</span><br><span class="line">                        duplication[<span class="number">0</span>] = numbers[i]</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        index = numbers[i]</span><br><span class="line">                        numbers[i], numbers[index] = numbers[index], numbers[i]</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h2 id="2-找出数组中重复的数字（不修改数组）"><a href="#2-找出数组中重复的数字（不修改数组）" class="headerlink" title="2. 找出数组中重复的数字（不修改数组）"></a>2. 找出数组中重复的数字（不修改数组）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">count_range</span>(<span class="params">self, numbers, length, start, end</span>):</span></span><br><span class="line">        <span class="keyword">if</span> numbers <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, length):</span><br><span class="line">            <span class="keyword">if</span> start &lt;= numbers[i] &lt;= end:</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> count  <span class="comment"># 返回区间的数目</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getDuplication</span>(<span class="params">self, numbers, length</span>):</span></span><br><span class="line">        <span class="keyword">if</span> numbers <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="built_in">len</span>(numbers) &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            start = <span class="number">1</span>  <span class="comment"># 1</span></span><br><span class="line">            end = length - <span class="number">1</span>  <span class="comment"># n</span></span><br><span class="line">            <span class="keyword">while</span> end &gt;= start:</span><br><span class="line">                middle = ((end - start) &gt;&gt; <span class="number">1</span>) + start</span><br><span class="line">                count = self.count_range(numbers, length, start, middle)</span><br><span class="line">                <span class="keyword">if</span> end == start:</span><br><span class="line">                    <span class="keyword">if</span> count &gt; <span class="number">1</span>:</span><br><span class="line">                        <span class="keyword">return</span> start</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> count &gt; (middle - start + <span class="number">1</span>):</span><br><span class="line">                    end = middle</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    start = middle + <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    num = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>]</span><br><span class="line">    s = Solution()</span><br><span class="line">    <span class="built_in">print</span> s.getDuplication(num, <span class="number">8</span>)</span><br></pre></td></tr></table></figure>

<h1 id="题-4：二维数组中的查找"><a href="#题-4：二维数组中的查找" class="headerlink" title="题 4：二维数组中的查找"></a>题 4：二维数组中的查找</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="comment"># array 二维列表</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Find</span>(<span class="params">self, matrix, rows, columns, number</span>):</span></span><br><span class="line">        <span class="comment"># write code here</span></span><br><span class="line">        found = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> matrix <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> rows &gt; <span class="number">0</span> <span class="keyword">and</span> columns &gt; <span class="number">0</span>:</span><br><span class="line">            row = <span class="number">0</span></span><br><span class="line">            column = columns - <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> row &lt; rows <span class="keyword">and</span> column &gt;= <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">if</span> matrix[row][column] == number:</span><br><span class="line">                    found = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">elif</span> matrix[row][column] &gt; number:</span><br><span class="line">                    column -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    row += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> found</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    matrix = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">9</span>],</span><br><span class="line">              [<span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">12</span>],</span><br><span class="line">              [<span class="number">4</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">13</span>],</span><br><span class="line">              [<span class="number">6</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">15</span>]]</span><br><span class="line">    s = Solution()</span><br><span class="line">    <span class="built_in">print</span> s.Find(matrix, <span class="number">4</span>, <span class="number">4</span>, <span class="number">7</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 牛客网中写法</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="comment"># array 二维列表</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Find</span>(<span class="params">self, number, matrix</span>):</span></span><br><span class="line">        <span class="comment"># write code here</span></span><br><span class="line">        found = <span class="literal">False</span></span><br><span class="line">        rows = <span class="built_in">len</span>(matrix)</span><br><span class="line">        columns = <span class="built_in">len</span>(matrix[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> matrix <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> rows &gt; <span class="number">0</span> <span class="keyword">and</span> columns &gt; <span class="number">0</span>:</span><br><span class="line">            row = <span class="number">0</span></span><br><span class="line">            column = columns - <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> row &lt; rows <span class="keyword">and</span> column &gt;= <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">if</span> matrix[row][column] == number:</span><br><span class="line">                    found = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">elif</span> matrix[row][column] &gt; number:</span><br><span class="line">                    column -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    row += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> found</span><br></pre></td></tr></table></figure>

<h1 id="题-5：替换空格"><a href="#题-5：替换空格" class="headerlink" title="题 5：替换空格"></a>题 5：替换空格</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="comment"># s 源字符串</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">replaceSpace</span>(<span class="params">self, s</span>):</span></span><br><span class="line">        <span class="comment"># write code here</span></span><br><span class="line">        s_list = <span class="built_in">list</span>(s)</span><br><span class="line">        s_replace = []</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> s_list:</span><br><span class="line">            <span class="keyword">if</span> item == <span class="string">&#x27; &#x27;</span>:</span><br><span class="line">                s_replace.append(<span class="string">&#x27;%&#x27;</span>)</span><br><span class="line">                s_replace.append(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">                s_replace.append(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                s_replace.append(item)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(s_replace)</span><br></pre></td></tr></table></figure>

<h1 id="题-6：从尾到头打印链表"><a href="#题-6：从尾到头打印链表" class="headerlink" title="题 6：从尾到头打印链表"></a>题 6：从尾到头打印链表</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x=<span class="literal">None</span></span>):</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.<span class="built_in">next</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 单链表的一个实现函数</span></span><br><span class="line">listnode = ListNode(<span class="number">1</span>)</span><br><span class="line">p = listnode</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">2</span>,<span class="number">11</span>):</span><br><span class="line">    listnode.<span class="built_in">next</span> = ListNode(i)</span><br><span class="line">    listnode = listnode.<span class="built_in">next</span></span><br><span class="line"><span class="keyword">while</span> p:</span><br><span class="line">    <span class="built_in">print</span> p.val</span><br><span class="line">    p = p.<span class="built_in">next</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用栈</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">printListFromTailToHead</span>(<span class="params">self, listNode</span>):</span></span><br><span class="line">        <span class="keyword">if</span> listNode.val <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        l = []</span><br><span class="line">        head = listNode</span><br><span class="line">        <span class="keyword">while</span> head:</span><br><span class="line">            l.insert(<span class="number">0</span>, head.val)</span><br><span class="line">            head = head.<span class="built_in">next</span></span><br><span class="line">        <span class="keyword">return</span> l</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line"><span class="built_in">print</span> s.printListFromTailToHead(p)</span><br></pre></td></tr></table></figure>

<h1 id="题-7：重建二叉树"><a href="#题-7：重建二叉树" class="headerlink" title="题 7：重建二叉树"></a>题 7：重建二叉树</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">输入某二叉树的前序遍历和中序遍历的结果，请重建出该二叉树。</span></span><br><span class="line"><span class="string">假设输入的前序遍历和中序遍历的结果中都不含重复的数字。</span></span><br><span class="line"><span class="string">例如输入前序遍历序列&#123;1,2,4,7,3,5,6,8&#125;和中序遍历序列&#123;4,7,2,1,5,3,8,6&#125;，则重建二叉树并返回。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.left = <span class="literal">None</span></span><br><span class="line">        self.right = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="comment"># 返回构造的TreeNode根节点</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reConstructBinaryTree</span>(<span class="params">self, pre, tin</span>):</span></span><br><span class="line">        <span class="comment"># write code here</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> pre <span class="keyword">and</span> <span class="keyword">not</span> tin:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        root = TreeNode(pre[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">set</span>(pre) != <span class="built_in">set</span>(tin):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        i = tin.index(pre[<span class="number">0</span>])</span><br><span class="line">        root.left = self.reConstructBinaryTree(pre[<span class="number">1</span>:i + <span class="number">1</span>], tin[:i])</span><br><span class="line">        root.right = self.reConstructBinaryTree(pre[i + <span class="number">1</span>:], tin[i + <span class="number">1</span>:])</span><br><span class="line">        <span class="keyword">return</span> root</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pre = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>]</span><br><span class="line">tin = [<span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>]</span><br><span class="line">test = Solution()</span><br><span class="line">newTree = test.reConstructBinaryTree(pre, tin)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按层序遍历输出树中某一层的值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">PrintNodeAtLevel</span>(<span class="params">treeNode, level</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> treeNode <span class="keyword">or</span> level &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> level == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(treeNode.val)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    PrintNodeAtLevel(treeNode.left, level - <span class="number">1</span>)</span><br><span class="line">    PrintNodeAtLevel(treeNode.right, level - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知树的深度按层遍历输出树的值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">PrintNodeByLevel</span>(<span class="params">treeNode, depth</span>):</span></span><br><span class="line">    <span class="keyword">for</span> level <span class="keyword">in</span> <span class="built_in">range</span>(depth):</span><br><span class="line">        PrintNodeAtLevel(treeNode, level)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="题-8：二叉树的下一个节点"><a href="#题-8：二叉树的下一个节点" class="headerlink" title="题 8：二叉树的下一个节点"></a>题 8：二叉树的下一个节点</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">给定一个二叉树和其中的一个结点，请找出中序遍历顺序的下一个结点并且返回。</span></span><br><span class="line"><span class="string">注意，树中的结点不仅包含左右子结点，同时包含指向父结点的指针。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeLinkNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.left = <span class="literal">None</span></span><br><span class="line">        self.right = <span class="literal">None</span></span><br><span class="line">        self.<span class="built_in">next</span> = <span class="literal">None</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetNext</span>(<span class="params">self, pNode</span>):</span></span><br><span class="line">        <span class="keyword">if</span> pNode == <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        pNext = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> pNode.right != <span class="literal">None</span>:</span><br><span class="line">            pRight = pNode.right</span><br><span class="line">            <span class="keyword">while</span> pRight.left != <span class="literal">None</span>:</span><br><span class="line">                pRight = pRight.left</span><br><span class="line">            pNext= pRight</span><br><span class="line">        <span class="keyword">elif</span> pNode.<span class="built_in">next</span> != <span class="literal">None</span>:</span><br><span class="line">            pCurrent = pNode</span><br><span class="line">            pParent = pCurrent.<span class="built_in">next</span></span><br><span class="line">            <span class="keyword">while</span> pParent != <span class="literal">None</span> <span class="keyword">and</span> pCurrent == pParent.right:</span><br><span class="line">                pCurrent = pParent</span><br><span class="line">                pParent = pCurrent.<span class="built_in">next</span></span><br><span class="line">            pNext = pParent</span><br><span class="line">        <span class="keyword">return</span> pNext</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution2</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetNext</span>(<span class="params">self, pNode</span>):</span></span><br><span class="line">        <span class="comment"># 输入是一个空节点</span></span><br><span class="line">        <span class="keyword">if</span> pNode == <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="comment"># 注意当前节点是根节点的情况。所以在最开始设定pNext = None, 如果下列情况都不满足, 说明当前结点为根节点, 直接输出None</span></span><br><span class="line">        pNext = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># 如果输入节点有右子树，则下一个结点是当前节点右子树中最左节点</span></span><br><span class="line">        <span class="keyword">if</span> pNode.right:</span><br><span class="line">            pNode = pNode.right</span><br><span class="line">            <span class="keyword">while</span> pNode.left:</span><br><span class="line">                pNode = pNode.left</span><br><span class="line">            pNext = pNode</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 如果当前节点有父节点且当前节点是父节点的左子节点, 下一个结点即为父节点</span></span><br><span class="line">            <span class="keyword">if</span> pNode.<span class="built_in">next</span> <span class="keyword">and</span> pNode.<span class="built_in">next</span>.left == pNode:</span><br><span class="line">                pNext = pNode.<span class="built_in">next</span></span><br><span class="line">            <span class="comment"># 如果当前节点有父节点且当前节点是父节点的右子节点, 那么向上遍历</span></span><br><span class="line">            <span class="comment"># 当遍历到当前节点为父节点的左子节点时, 输入节点的下一个结点为当前节点的父节点</span></span><br><span class="line">            <span class="keyword">elif</span> pNode.<span class="built_in">next</span> <span class="keyword">and</span> pNode.<span class="built_in">next</span>.right == pNode:</span><br><span class="line">                pNode = pNode.<span class="built_in">next</span></span><br><span class="line">                <span class="keyword">while</span> pNode.<span class="built_in">next</span> <span class="keyword">and</span> pNode.<span class="built_in">next</span>.right == pNode:</span><br><span class="line">                    pNode = pNode.<span class="built_in">next</span></span><br><span class="line">                <span class="comment"># 遍历终止时当前节点有父节点, 说明当前节点是父节点的左子节点, 输入节点的下一个结点为当前节点的父节点</span></span><br><span class="line">                <span class="comment"># 反之终止时当前节点没有父节点, 说明当前节点在位于根节点的右子树, 没有下一个结点</span></span><br><span class="line">                <span class="keyword">if</span> pNode.<span class="built_in">next</span>:</span><br><span class="line">                    pNext = pNode.<span class="built_in">next</span></span><br><span class="line">        <span class="keyword">return</span> pNext</span><br></pre></td></tr></table></figure>

<h1 id="题-9：用两个栈实现队列"><a href="#题-9：用两个栈实现队列" class="headerlink" title="题 9：用两个栈实现队列"></a>题 9：用两个栈实现队列</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.stack1 = []</span><br><span class="line">        self.stack2 = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span>(<span class="params">self, node</span>):</span></span><br><span class="line">        self.stack1.append(node)</span><br><span class="line">    <span class="comment"># write code here</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(self.stack2) == <span class="number">0</span> <span class="keyword">and</span> <span class="built_in">len</span>(self.stack1) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">len</span>(self.stack2) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">while</span> <span class="built_in">len</span>(self.stack1) &gt; <span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">                self.stack2.append(self.stack1.pop())</span><br><span class="line">        <span class="keyword">return</span> self.stack2.pop()</span><br><span class="line"><span class="comment"># return xx</span></span><br></pre></td></tr></table></figure>

<h1 id="题-10：斐波那契数列"><a href="#题-10：斐波那契数列" class="headerlink" title="题 10：斐波那契数列"></a>题 10：斐波那契数列</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Fibonacci</span>(<span class="params">self, n, cache=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> cache <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            cache = &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> n <span class="keyword">in</span> cache:</span><br><span class="line">            <span class="keyword">return</span> cache[n]</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        cache[n] = self.Fibonacci(n - <span class="number">1</span>, cache) + self.Fibonacci(n - <span class="number">2</span>, cache)</span><br><span class="line">        <span class="keyword">return</span> cache[n]</span><br></pre></td></tr></table></figure>

<h1 id="题-11：旋转数组的最小数字"><a href="#题-11：旋转数组的最小数字" class="headerlink" title="题 11：旋转数组的最小数字"></a>题 11：旋转数组的最小数字</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minNumberInRotateArray</span>(<span class="params">self, array</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(array) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        head, end = <span class="number">0</span>, <span class="built_in">len</span>(array) - <span class="number">1</span></span><br><span class="line">        mid = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> array[head] &gt;= array[end]:</span><br><span class="line">            <span class="keyword">if</span> end - head == <span class="number">1</span>:</span><br><span class="line">                mid = end</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            mid = (end + head) // <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> array[head] == array[end] <span class="keyword">and</span> array[head] == array[mid]:</span><br><span class="line">                <span class="keyword">return</span> self.order_min(array, head, end)</span><br><span class="line">            <span class="keyword">if</span> array[mid] &gt;= array[head]:</span><br><span class="line">                head = mid</span><br><span class="line">            <span class="keyword">elif</span> array[mid] &lt;= array[end]:</span><br><span class="line">                end = mid</span><br><span class="line">        <span class="keyword">return</span> array[mid]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">order_min</span>(<span class="params">self, array, head, end</span>):</span></span><br><span class="line">        result = array[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(array)):</span><br><span class="line">            <span class="keyword">if</span> i &lt; result:</span><br><span class="line">                result = i</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<h1 id="题-12：矩阵中的路径"><a href="#题-12：矩阵中的路径" class="headerlink" title="题 12：矩阵中的路径"></a>题 12：矩阵中的路径</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hasPath</span>(<span class="params">self, matrix, rows, cols, path</span>):</span></span><br><span class="line">        <span class="keyword">if</span> matrix == <span class="literal">None</span> <span class="keyword">or</span> rows &lt; <span class="number">1</span> <span class="keyword">or</span> cols &lt; <span class="number">1</span> <span class="keyword">or</span> path == <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        visited = [<span class="number">0</span>] * (rows * cols)</span><br><span class="line"></span><br><span class="line">        pathLength = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(rows):</span><br><span class="line">            <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(cols):</span><br><span class="line">                <span class="keyword">if</span> self.hasPathCore(matrix, rows, cols, row, col, path, pathLength, visited):</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hasPathCore</span>(<span class="params">self, matrix, rows, cols, row, col, path, pathLength, visited</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(path) == pathLength:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        hasPath = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> row &gt;= <span class="number">0</span> <span class="keyword">and</span> row &lt; rows <span class="keyword">and</span> col &gt;= <span class="number">0</span> <span class="keyword">and</span> col &lt; cols <span class="keyword">and</span> matrix[row * cols + col] == path[pathLength] <span class="keyword">and</span> <span class="keyword">not</span> \</span><br><span class="line">        visited[row * cols + col]:</span><br><span class="line"></span><br><span class="line">            pathLength += <span class="number">1</span></span><br><span class="line">            visited[row * cols + col] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">            hasPath = self.hasPathCore(matrix, rows, cols, row, col - <span class="number">1</span>, path, pathLength, visited) <span class="keyword">or</span> \</span><br><span class="line">                      self.hasPathCore(matrix, rows, cols, row - <span class="number">1</span>, col, path, pathLength, visited) <span class="keyword">or</span> \</span><br><span class="line">                      self.hasPathCore(matrix, rows, cols, row, col + <span class="number">1</span>, path, pathLength, visited) <span class="keyword">or</span> \</span><br><span class="line">                      self.hasPathCore(matrix, rows, cols, row + <span class="number">1</span>, col, path, pathLength, visited)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> hasPath:</span><br><span class="line">                pathLength -= <span class="number">1</span></span><br><span class="line">                visited[row * cols + col] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> hasPath</span><br></pre></td></tr></table></figure>

<h1 id="题-13：机器人的运动范围"><a href="#题-13：机器人的运动范围" class="headerlink" title="题 13：机器人的运动范围"></a>题 13：机器人的运动范围</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">movingCount</span>(<span class="params">self, threshold, rows, cols</span>):</span></span><br><span class="line">        <span class="keyword">if</span> threshold &lt; <span class="number">0</span> <span class="keyword">or</span> rows &lt;= <span class="number">0</span> <span class="keyword">or</span> cols &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        visited = [<span class="literal">False</span>] * (rows * cols)</span><br><span class="line">        count = self.movingCountCore(threshold, rows, cols, <span class="number">0</span>, <span class="number">0</span>, visited)</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">movingCountCore</span>(<span class="params">self, threshold, rows, cols, row, col, visited</span>):</span></span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> self.check(threshold, rows, cols, row, col, visited):</span><br><span class="line">            visited[row * cols + col] = <span class="literal">True</span></span><br><span class="line">            count = <span class="number">1</span> + self.movingCountCore(threshold, rows, cols, row, col - <span class="number">1</span>, visited) + \</span><br><span class="line">                    self.movingCountCore(threshold, rows, cols, row, col + <span class="number">1</span>, visited) + \</span><br><span class="line">                    self.movingCountCore(threshold, rows, cols, row - <span class="number">1</span>, col, visited) + \</span><br><span class="line">                    self.movingCountCore(threshold, rows, cols, row + <span class="number">1</span>, col, visited)</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">self, threshold, rows, cols, row, col, visited</span>):</span></span><br><span class="line">        <span class="keyword">if</span> row &gt;= <span class="number">0</span> <span class="keyword">and</span> row &lt;= rows <span class="keyword">and</span> col &gt;= <span class="number">0</span> <span class="keyword">and</span> col &lt;= cols <span class="keyword">and</span> self.getDigitSum(row) + self.getDigitSum(</span><br><span class="line">                col) &lt;= threshold <span class="keyword">and</span> <span class="keyword">not</span> visited[row * cols + col]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getDigitSum</span>(<span class="params">self, number</span>):</span></span><br><span class="line">        <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> number &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">sum</span> += number % <span class="number">10</span></span><br><span class="line">            number = number // <span class="number">10</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span></span><br></pre></td></tr></table></figure>

<h1 id="题-14：剪绳子"><a href="#题-14：剪绳子" class="headerlink" title="题 14：剪绳子"></a>题 14：剪绳子</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">max_product_after_cutting1</span>(<span class="params">self, length</span>):</span> <span class="comment"># 使用动态规划，自下而上解决</span></span><br><span class="line">        <span class="keyword">if</span> length &lt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> length == <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> length == <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">        products = [<span class="number">0</span>] * (length + <span class="number">1</span>)</span><br><span class="line">        products[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">        products[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">        products[<span class="number">2</span>] = <span class="number">2</span></span><br><span class="line">        products[<span class="number">3</span>] = <span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>, length + <span class="number">1</span>):</span><br><span class="line">            <span class="built_in">max</span> = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, i / <span class="number">2</span> + <span class="number">1</span>):</span><br><span class="line">                product = products[j] * products[i - j]</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">max</span> &lt; product:</span><br><span class="line">                    <span class="built_in">max</span> = product</span><br><span class="line">                products[i] = <span class="built_in">max</span></span><br><span class="line">        <span class="built_in">max</span> = products[length]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">max_product_after_cutting2</span>(<span class="params">self, length</span>):</span>  <span class="comment"># 贪婪算法</span></span><br><span class="line">        <span class="keyword">if</span> length &lt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> length == <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> length == <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">        timesof3 = length / <span class="number">3</span></span><br><span class="line">        <span class="keyword">if</span> length - timesof3 * <span class="number">3</span> == <span class="number">1</span>:</span><br><span class="line">            timesof3 -= <span class="number">1</span></span><br><span class="line">        timesof2 = (length - timesof3 * <span class="number">3</span>) / <span class="number">2</span></span><br><span class="line">        <span class="built_in">max</span> = (<span class="number">3</span> ** timesof3) * (<span class="number">2</span> ** timesof2)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    s = Solution()</span><br><span class="line">    result1 = s.max_product_after_cutting1(<span class="number">8</span>)</span><br><span class="line">    result2 = s.max_product_after_cutting2(<span class="number">8</span>)</span><br><span class="line">    <span class="built_in">print</span> result1, result2</span><br></pre></td></tr></table></figure>

<h1 id="题-15：二进制中-1-的个数"><a href="#题-15：二进制中-1-的个数" class="headerlink" title="题 15：二进制中 1 的个数"></a>题 15：二进制中 1 的个数</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">NumberOf1</span>(<span class="params">self, n</span>):</span>  <span class="comment"># 死循环</span></span><br><span class="line">        <span class="comment"># n = bin(n)</span></span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> n:</span><br><span class="line">            <span class="keyword">if</span> n &amp; <span class="number">1</span>:</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">            n = n &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Numberof1_2</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        l = <span class="built_in">len</span>(<span class="built_in">bin</span>(n))</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        flag = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">            <span class="keyword">if</span> n &amp; flag:</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">            flag = flag &lt;&lt; <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Numberof1_3</span>(<span class="params">self, n</span>):</span>  <span class="comment"># 最佳解法</span></span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> n:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            n = (n - <span class="number">1</span>) &amp; n</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Numberof1_4</span>(<span class="params">self, n</span>):</span></span><br><span class="line">        <span class="keyword">if</span> n &lt; <span class="number">0</span>:</span><br><span class="line">            s = <span class="built_in">bin</span>(n &amp; <span class="number">0xffffffff</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            s = <span class="built_in">bin</span>(n)</span><br><span class="line">        <span class="keyword">return</span> s.count(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    s = Solution()</span><br><span class="line">    result1 = s.NumberOf1(<span class="number">9</span>)</span><br><span class="line">    result2 = s.Numberof1_2(<span class="number">78787</span>)</span><br><span class="line">    result3 = s.Numberof1_3(<span class="number">989798798798</span>)</span><br><span class="line">    result4 = s.Numberof1_4(<span class="number">9</span>)</span><br><span class="line">    <span class="built_in">print</span> result1, result2, result3, result4</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://iziyang.github.io/2018/06/04/io-schduler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://s3plus.meituan.net/v1/mss_f32142e8d47149129e9550e929704625/yzz-test-image/qrcode_for_gh_3cfae3cf61d9_1280.jpg">
      <meta itemprop="name" content="原少子杨">
      <meta itemprop="description" content="目前是一名 SRE，爱好 Go 和 Python">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="原少子杨">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/04/io-schduler/" class="post-title-link" itemprop="url">IO 调度算法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-04 10:47:49" itemprop="dateCreated datePublished" datetime="2018-06-04T10:47:49+08:00">2018-06-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-17 19:59:59" itemprop="dateModified" datetime="2021-05-17T19:59:59+08:00">2021-05-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a>
                </span>
            </span>

          
            <span id="/2018/06/04/io-schduler/" class="post-meta-item leancloud_visitors" data-flag-title="IO 调度算法" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/06/04/io-schduler/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/06/04/io-schduler/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="IO-调度算法"><a href="#IO-调度算法" class="headerlink" title="IO 调度算法"></a>IO 调度算法</h1><h2 id="NOOP"><a href="#NOOP" class="headerlink" title="NOOP"></a>NOOP</h2><p>NOOP 全称 No Operation，中文名称电梯式调度器，该算法实现了最简单的 FIFO 队列，所有 I/O 请求大致按照先来后到的顺序进行操作。之所以说”大致“，原因是 NOOP 在 FIFO 的基础上还做了相邻 IO 请求的合并，并不是完完全全按照先进先出的规则满足 IO 请求。它是基于先入先出（FIFO）队列概念的 Linux 内核里最简单的 I/O 调度器。此调度程序最适合于固态硬盘。</p>
<h2 id="Anticipatory"><a href="#Anticipatory" class="headerlink" title="Anticipatory"></a>Anticipatory</h2><p>Anticipatory 的中文含义是”预料的，预想的”，顾名思义有个 I/O 发生的时候，如果又有进程请求 I/O 操作，则将产生一个默认的 6 毫秒猜测时间，猜测下一个进程请求 I/O 是要干什么的。这个 I/O 调度器对读操作优化服务时间，在提供一个 I/O 的时候进行短时间等待，使进程能够提交到另外的 I/O。Anticipatory 算法从 Linux 2.6.33 版本后被删除了，因为使用 CFQ 通过配置也能达到 Anticipatory 的效果。</p>
<h2 id="DeadLine"><a href="#DeadLine" class="headerlink" title="DeadLine"></a>DeadLine</h2><p>Deadline 翻译成中文是截止时间调度器，它避免有些请求太长时间不能被处理。另外可以区分对待读操作和写操作。DEADLINE 额外分别为读 I/O 和写 I/O 提供了 FIFO 队列。</p>
<h2 id="CFQ"><a href="#CFQ" class="headerlink" title="CFQ"></a>CFQ</h2><p>CFQ 全称 Completely Fair Scheduler ，中文名称完全公平调度器，它是现在许多 Linux 发行版的默认调度器，CFQ 是内核默认选择的 I/O 调度器。该算法的特点是按照 IO 请求的地址进行排序，而不是按照先来后到的顺序来进行响应。CFQ 为每个进程/线程，单独创建一个队列来管理该进程所产生的请求，也就是说每个进程一个队列，各队列之间的调度使用时间片来调度，</p>
<h1 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h1><h2 id="查看当前系统支持的I-O调度器"><a href="#查看当前系统支持的I-O调度器" class="headerlink" title="查看当前系统支持的I/O调度器"></a>查看当前系统支持的I/O调度器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[sankuai@dx-cloud-climc01 ~]$ dmesg | grep -i scheduler</span><br><span class="line">io scheduler noop registered</span><br><span class="line">io scheduler anticipatory registered</span><br><span class="line">io scheduler deadline registered</span><br><span class="line">io scheduler cfq registered (default)</span><br></pre></td></tr></table></figure>

<h2 id="查看一个硬盘使用的I-O调度器"><a href="#查看一个硬盘使用的I-O调度器" class="headerlink" title="查看一个硬盘使用的I/O调度器"></a>查看一个硬盘使用的I/O调度器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[sankuai@gh-cloud-mss-store02 ~]$ cat /sys/block/sda/queue/scheduler</span><br><span class="line">noop anticipatory deadline [cfq]</span><br></pre></td></tr></table></figure>

<h2 id="查看调度算法参数的含义"><a href="#查看调度算法参数的含义" class="headerlink" title="查看调度算法参数的含义"></a>查看调度算法参数的含义</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install kernel-doc</span><br><span class="line">比如:/usr/share/doc/kernel-doc-2.6.32/Documentation/block/deadline-iosched.txt</span><br></pre></td></tr></table></figure>

<h2 id="永久修改系统-IO-调度器"><a href="#永久修改系统-IO-调度器" class="headerlink" title="永久修改系统 IO 调度器"></a>永久修改系统 IO 调度器</h2><h3 id="grubby-命令"><a href="#grubby-命令" class="headerlink" title="grubby 命令"></a>grubby 命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> grubby --grub --update-kernel=ALL --args=<span class="string">&quot;elevator=deadline</span></span></span><br></pre></td></tr></table></figure>

<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">使用vi编辑器修改grub配置文件</span><br><span class="line"><span class="meta">#</span><span class="bash">vi cat /etc/default/grub</span></span><br><span class="line"><span class="meta">#</span><span class="bash">修改第五行，在行尾添加<span class="comment">#</span></span></span><br><span class="line">elevator= cfq</span><br><span class="line"> </span><br><span class="line">然后保存文件，重新编译配置文件，</span><br><span class="line"><span class="meta">#</span><span class="bash">grub2-mkconfig -o /boot/grub2/grub.cfg</span></span><br></pre></td></tr></table></figure>

<h1 id="算法调优"><a href="#算法调优" class="headerlink" title="算法调优"></a>算法调优</h1><h2 id="CFQ-算法参数"><a href="#CFQ-算法参数" class="headerlink" title="CFQ 算法参数"></a>CFQ 算法参数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[sankuai@gh-cloud-mss-store02 ~]$ ls -l /sys/block/sda/queue/iosched</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 back_seek_max</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 back_seek_penalty</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 fifo_expire_async</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 fifo_expire_sync</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 group_idle</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 group_isolation</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 low_latency</span><br><span class="line">-rw-r--r-- 1 root root 4096 May 24  2017 quantum</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 slice_async</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 slice_async_rq</span><br><span class="line">-rw-r--r-- 1 root root 4096 May 24  2017 slice_idle</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 slice_sync</span><br></pre></td></tr></table></figure>

<ul>
<li><p>back_seek_max</p>
<p>默认 16384。该参数规定了磁头向后寻址的最大范围,默认值是16M。对于请求所访问的扇区号在磁头后方的请求，cfq 会像向前寻址的请求一样调度他。</p>
</li>
<li><p>back_seek_penalty</p>
<p>默认值是 2。该参数用来计算向后寻址的代价。相对于前方查找，后方查找的距离为 1/2(1/back_seek_penalty)时，cfq 调度时就认为这两个请求寻址的代价是相同的。</p>
</li>
<li><p>fifo_expire_async</p>
<p>默认值是250ms。该参数用来控制异步请求的超时时间。如果队列被激活后，则优先检查是否有请求超时，如果有超时的请求，则派发。但是，在队列激活的期间内，只会派发 一个超时的请求，其余的请求按照请求的优先级，以及所访问的扇区号大小来派发。</p>
</li>
<li><p>fifo_expire_sync</p>
<p>默认值是125ms。功能类似于fifo_expire_async参数，该参数用于控制同步请求的超时时间，。</p>
</li>
<li><p>group_idle</p>
<p>默认值是 8ms，该参数为了提高吞吐量。</p>
</li>
<li><p>group_isolation</p>
<p>该参数用来标识应用程序所在的cgroup。</p>
</li>
<li><p>low_latency</p>
<p>该参数用来表示低延迟，默认值是1ms</p>
</li>
<li><p>quantum</p>
<p>该参数用于控制队列派发到设备驱动层所含有的请求数，默认值是8。不管是同步队列还是异步队列, 在时间片内，超过这个限制，则不再派发请求。对于异步队列 而言，请求数的派发个数还取决于参数slice_async_rq。</p>
</li>
<li><p>slice_async</p>
<p>默认值是 40ms。这个参数功能同slice_sync，但是用来计算异步队列的时间片。<br>异步队列的时间片的计算公式是：time slice＝slice_async + (slice_async/5 * (4 - priority))；</p>
</li>
<li><p>slice_async_rq</p>
<p>默认值是 2。这个参数用来计算在时间片内异步请求被派发的最大数。同样，最大请求数也依赖于队列的优先级。计算公式是：最大请求数＝2 * slice_async_rq( 8 –priority );</p>
</li>
<li><p>slice_idle</p>
<p>默认值是 8ms，这个参数只控制同步队列的idle time。当同步队列当前没有请求派发时，并不切换到其他队列，而是等待 8ms，以便让应用程序产生更多的请求。直到同步队列的时间片用完。</p>
</li>
<li><p>slice_sync</p>
<p>默认值是 100ms。这个参数用来计算同步队列的时间片, 默认值是100ms。时间片还依赖于队列的优先级。同步队列的时间片的计算公式是：time slice＝slice_sync + (slice_sync/5 * (4 - priority))；</p>
</li>
</ul>
<h2 id="Anticipatory-算法参数"><a href="#Anticipatory-算法参数" class="headerlink" title="Anticipatory 算法参数"></a>Anticipatory 算法参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">The parameters are:</span><br><span class="line">* read_expire</span><br><span class="line">    Controls how long until a read request becomes &quot;expired&quot;. It also controls the interval between which expired requests are served, so set to 50, a request might take anywhere &lt; 100ms to be serviced _if_ it is the next on the expired list. Obviously request expiration strategies won&#x27;t make the disk go faster. The result basically equates to the timeslice a single reader gets in the presence of other IO. 100*((seek time / read_expire) + 1) is very roughly the % streaming read efficiency your disk should get with multiple readers.</span><br><span class="line"></span><br><span class="line">* read_batch_expire</span><br><span class="line">    Controls how much time a batch of reads is given before pending writes are served. A higher value is more efficient. This might be set below read_expire if writes are to be given higher priority than reads, but reads are to be as efficient as possible when there are no writes. Generally though, it should be some multiple of read_expire.</span><br><span class="line"></span><br><span class="line">* write_expire, and</span><br><span class="line">* write_batch_expire are equivalent to the above, for writes.</span><br><span class="line"></span><br><span class="line">* antic_expire</span><br><span class="line">    Controls the maximum amount of time we can anticipate a good read (one with a short seek distance from the most recently completed request) before giving up. Many other factors may cause anticipation to be stopped early, or some processes will not be &quot;anticipated&quot; at all. Should be a bit higher for big seek time devices though not a linear correspondence - most processes have only a few ms thinktime.</span><br><span class="line"></span><br><span class="line">In addition to the tunables above there is a read-only file named est_time</span><br><span class="line">which, when read, will show:</span><br><span class="line"></span><br><span class="line">    - The probability of a task exiting without a cooperating task</span><br><span class="line">      submitting an anticipated IO.</span><br><span class="line"></span><br><span class="line">    - The current mean think time.</span><br><span class="line"></span><br><span class="line">    - The seek distance used to determine if an incoming IO is better.</span><br></pre></td></tr></table></figure>



<h2 id="测试-fio"><a href="#测试-fio" class="headerlink" title="测试-fio"></a>测试-fio</h2><p>可以使用专业的工具 fio，或者命令 dd。</p>
<h3 id="fio-格式"><a href="#fio-格式" class="headerlink" title="fio 格式"></a>fio 格式</h3><p>fio 可以采用命令行格式，也可以采用 jobfile 格式。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fio [options] [jobfile] ...</span><br><span class="line">  options</span><br><span class="line">    --output=filename</span><br></pre></td></tr></table></figure>

<h3 id="jobfile-参数"><a href="#jobfile-参数" class="headerlink" title="jobfile 参数"></a>jobfile 参数</h3><h4 id="General"><a href="#General" class="headerlink" title="General"></a>General</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runtime=time 单位：seconds</span><br></pre></td></tr></table></figure>

<h4 id="I-O-type"><a href="#I-O-type" class="headerlink" title="I/O type"></a>I/O type</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">direct=bool # 是否使用缓存，true 表示不使用缓存</span><br><span class="line">readwrite=str </span><br><span class="line">    read # 顺序读</span><br><span class="line">    write # 顺序写</span><br><span class="line">    randread # 随机读</span><br><span class="line">    randwrite # 随即写</span><br><span class="line">    rw # 顺序读写</span><br><span class="line">    randrw # 随机读写</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h4 id="Block-size"><a href="#Block-size" class="headerlink" title="Block size"></a>Block size</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">blocksize/bs=int[,int][,int] # read, writes, trimes，默认是 4096</span><br><span class="line">    bs=256k</span><br><span class="line">blocksize_range/bsrange=irange[,irange][,irange]</span><br><span class="line">    bsrange=1k-4k,2k-8k</span><br><span class="line">bssplit=str</span><br></pre></td></tr></table></figure>

<h4 id="Buffers-and-memory"><a href="#Buffers-and-memory" class="headerlink" title="Buffers and memory"></a>Buffers and memory</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iomem=str, mem=str</span><br><span class="line">    malloc</span><br><span class="line">    shm</span><br><span class="line">    shmhuge</span><br><span class="line">    mmap</span><br></pre></td></tr></table></figure>

<h4 id="I-O-size"><a href="#I-O-size" class="headerlink" title="I/O size"></a>I/O size</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">size=int # 一个任务中每一个线程的总大小</span><br><span class="line">io_size=int, io_limit=int</span><br><span class="line">filesize=irange(int)</span><br></pre></td></tr></table></figure>

<h4 id="I-O-engine"><a href="#I-O-engine" class="headerlink" title="I/O engine"></a>I/O engine</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ioengine=str</span><br><span class="line">    sync # 基本的读写操作</span><br><span class="line">    psync # 基本的 pread 和 pwrite</span><br><span class="line">    vsync # 基本的 readv 和 writev 将通过将相邻的 I/O 合并为一个提交来模拟排队。</span><br><span class="line">    libaio # Linux 原生的异步 I/O</span><br></pre></td></tr></table></figure>

<h4 id="I-O-depth"><a href="#I-O-depth" class="headerlink" title="I/O depth"></a>I/O depth</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iodepth=int # 线程的数量</span><br></pre></td></tr></table></figure>

<h4 id="I-O-rate"><a href="#I-O-rate" class="headerlink" title="I/O rate"></a>I/O rate</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">thinktime=time # I/O 发出后，在一段时间内停止，再发出下一个</span><br><span class="line">rate=int[,int][,int] # 限制某一个任务的带宽</span><br></pre></td></tr></table></figure>

<h4 id="I-O-latency"><a href="#I-O-latency" class="headerlink" title="I/O latency"></a>I/O latency</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">latency_target=time # 如果设置，fio将尝试查找给定工作负载运行时的最高性能点，同时保持低于此目标的延迟。</span><br></pre></td></tr></table></figure>

<h4 id="I-O-replay"><a href="#I-O-replay" class="headerlink" title="I/O replay"></a>I/O replay</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">write_iolog=str</span><br><span class="line">read_iolog=str</span><br></pre></td></tr></table></figure>

<h4 id="Threads-processes-and-job-synchronization"><a href="#Threads-processes-and-job-synchronization" class="headerlink" title="Threads, processes and job synchronization"></a>Threads, processes and job synchronization</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread # fio 默认是通过 fork 的方式创建任务，但是如果这个参数指定，就会采用 POSIX 的线程函数来创建线程</span><br></pre></td></tr></table></figure>

<h4 id="Verification"><a href="#Verification" class="headerlink" title="Verification"></a>Verification</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">verify_only # 不指定工作负载，只验证数据是否符合之前的</span><br></pre></td></tr></table></figure>

<h4 id="Steady-state"><a href="#Steady-state" class="headerlink" title="Steady state"></a>Steady state</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">steadystate=str:float, ss=str:float # 定义评估稳态性能的标准和限制。</span><br><span class="line">    iops # 收集 iops 数据 如：iops:2</span><br></pre></td></tr></table></figure>

<h4 id="Measurements-and-reporting"><a href="#Measurements-and-reporting" class="headerlink" title="Measurements and reporting"></a>Measurements and reporting</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">write_bw_log=str</span><br><span class="line">write_lat_log=str</span><br></pre></td></tr></table></figure>

<h3 id="相关测试用例"><a href="#相关测试用例" class="headerlink" title="相关测试用例"></a>相关测试用例</h3><h4 id="随机读"><a href="#随机读" class="headerlink" title="随机读"></a>随机读</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Rand_Read_Testing]</span><br><span class="line">direct=1</span><br><span class="line">iodepth=128</span><br><span class="line">rw=randread</span><br><span class="line">ioengine=libaio</span><br><span class="line">bs=4k</span><br><span class="line">size=1G</span><br><span class="line">numjobs=1</span><br><span class="line">runtime=1000</span><br><span class="line">group_reporting</span><br><span class="line">filename=/s3plus/mount/002/randread.test</span><br></pre></td></tr></table></figure>

<p>参考：<a target="_blank" rel="noopener" href="http://devopslinux.com/2016/07/23/PTE-fio/">http://devopslinux.com/2016/07/23/PTE-fio/</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">顺序读</span></span><br><span class="line">fio -filename=/dev/sda -direct=1 -iodepth 1 -thread -rw=read -ioengine=psync -bs=16k -size=200G -numjobs=30 -runtime=1000 -group_reporting -name=mytest</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">顺序写</span></span><br><span class="line">fio -filename=/dev/sda -direct=1 -iodepth 1 -thread -rw=write -ioengine=psync -bs=16k -size=200G -numjobs=30 -runtime=1000 -group_reporting -name=mytest</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">随机读</span></span><br><span class="line">fio -filename=/dev/sda -direct=1 -iodepth 1 -thread -rw=randread -ioengine=psync -bs=16k -size=200G -numjobs=30 -runtime=1000 -group_reporting -name=mytest</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">随机写</span></span><br><span class="line">fio -filename=/dev/sda -direct=1 -iodepth 1 -thread -rw=randwrite -ioengine=psync -bs=16k -size=200G -numjobs=30 -runtime=1000 -group_reporting -name=mytest</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">混合随机读写</span></span><br><span class="line">fio -filename=/dev/sda -direct=1 -iodepth 1 -thread -rw=randrw -rwmixread=70 -ioengine=psync -bs=16k -size=200G -numjobs=30 -runtime=100 -group_reporting -name=mytest -ioscheduler=noop</span><br></pre></td></tr></table></figure>

<h4 id="混合随机读写"><a href="#混合随机读写" class="headerlink" title="混合随机读写"></a>混合随机读写</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[randrw]</span><br><span class="line">direct=1</span><br><span class="line">iodepth=128</span><br><span class="line">rw=randrw</span><br><span class="line">ioengine=libaio</span><br><span class="line">bs=4k</span><br><span class="line">size=1G</span><br><span class="line">numjobs=16</span><br><span class="line">runtime=60</span><br><span class="line">group_reporting</span><br><span class="line">filename=/s3plus/mount/002/randrw.file</span><br></pre></td></tr></table></figure>







<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/linux/l-lo-io-scheduler-optimize-performance/index.html">https://www.ibm.com/developerworks/cn/linux/l-lo-io-scheduler-optimize-performance/index.html</a></p>
<p><a target="_blank" rel="noopener" href="http://bbs.chinaunix.net/thread-1967733-1-1.html">http://bbs.chinaunix.net/thread-1967733-1-1.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/18/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><span class="page-number current">19</span><a class="page-number" href="/page/20/">20</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" href="/page/20/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="原少子杨"
      src="https://s3plus.meituan.net/v1/mss_f32142e8d47149129e9550e929704625/yzz-test-image/qrcode_for_gh_3cfae3cf61d9_1280.jpg">
  <p class="site-author-name" itemprop="name">原少子杨</p>
  <div class="site-description" itemprop="description">目前是一名 SRE，爱好 Go 和 Python</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">133</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">原少子杨</span>
</div>
  <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly9waXNjZXMudGhlbWUtbmV4dC5vcmc=">NexT.Pisces</span> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '6OsbpvAuMocftjPmQVE5FgOG-gzGzoHsz',
      appKey     : 'Nzz2gSaPPFT179OKLQwrJB6v',
      placeholder: "欢迎留言和我交流",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
