<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="google-site-verification" content="2k9N_1AINrpZtRVd2DTmGWusoSitSdkkRTBT7tORVAY">
  <meta name="baidu-site-verification" content="IFiFMa7Cit">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"iziyang.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="IO 调度算法NOOPNOOP 全称 No Operation，中文名称电梯式调度器，该算法实现了最简单的 FIFO 队列，所有 I&#x2F;O 请求大致按照先来后到的顺序进行操作。之所以说”大致“，原因是 NOOP 在 FIFO 的基础上还做了相邻 IO 请求的合并，并不是完完全全按照先进先出的规则满足 IO 请求。它是基于先入先出（FIFO）队列概念的 Linux 内核里最简单的 I&#x2F;O 调度器。此调">
<meta property="og:type" content="article">
<meta property="og:title" content="IO 调度算法">
<meta property="og:url" content="http://iziyang.github.io/2018/06/04/io-schduler/index.html">
<meta property="og:site_name" content="原少子杨">
<meta property="og:description" content="IO 调度算法NOOPNOOP 全称 No Operation，中文名称电梯式调度器，该算法实现了最简单的 FIFO 队列，所有 I&#x2F;O 请求大致按照先来后到的顺序进行操作。之所以说”大致“，原因是 NOOP 在 FIFO 的基础上还做了相邻 IO 请求的合并，并不是完完全全按照先进先出的规则满足 IO 请求。它是基于先入先出（FIFO）队列概念的 Linux 内核里最简单的 I&#x2F;O 调度器。此调">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2018-06-04T02:47:49.000Z">
<meta property="article:modified_time" content="2021-05-17T11:59:59.827Z">
<meta property="article:author" content="原少子杨">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://iziyang.github.io/2018/06/04/io-schduler/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>IO 调度算法 | 原少子杨</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">原少子杨</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">聊聊技术、产品和商业</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-所有文章">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>所有文章</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-sre">

    <a href="/categories/SRE" rel="section"><i class="fa fa-cloud fa-fw"></i>SRE</a>

  </li>
        <li class="menu-item menu-item-编程">

    <a href="/categories/%E7%BC%96%E7%A8%8B" rel="section"><i class="fa fa-code fa-fw"></i>编程</a>

  </li>
        <li class="menu-item menu-item-读书">

    <a href="/categories/%E8%AF%BB%E4%B9%A6" rel="section"><i class="fa fa-book fa-fw"></i>读书</a>

  </li>
        <li class="menu-item menu-item-杂谈">

    <a href="/categories/%E6%9D%82%E8%B0%88" rel="section"><i class="fa fa-pencil-alt fa-fw"></i>杂谈</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://iziyang.github.io/2018/06/04/io-schduler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://s3plus.meituan.net/v1/mss_f32142e8d47149129e9550e929704625/yzz-test-image/qrcode_for_gh_3cfae3cf61d9_1280.jpg">
      <meta itemprop="name" content="原少子杨">
      <meta itemprop="description" content="目前是一名 SRE，爱好 Go 和 Python">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="原少子杨">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          IO 调度算法
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-04 10:47:49" itemprop="dateCreated datePublished" datetime="2018-06-04T10:47:49+08:00">2018-06-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-17 19:59:59" itemprop="dateModified" datetime="2021-05-17T19:59:59+08:00">2021-05-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a>
                </span>
            </span>

          
            <span id="/2018/06/04/io-schduler/" class="post-meta-item leancloud_visitors" data-flag-title="IO 调度算法" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/06/04/io-schduler/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/06/04/io-schduler/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="IO-调度算法"><a href="#IO-调度算法" class="headerlink" title="IO 调度算法"></a>IO 调度算法</h1><h2 id="NOOP"><a href="#NOOP" class="headerlink" title="NOOP"></a>NOOP</h2><p>NOOP 全称 No Operation，中文名称电梯式调度器，该算法实现了最简单的 FIFO 队列，所有 I/O 请求大致按照先来后到的顺序进行操作。之所以说”大致“，原因是 NOOP 在 FIFO 的基础上还做了相邻 IO 请求的合并，并不是完完全全按照先进先出的规则满足 IO 请求。它是基于先入先出（FIFO）队列概念的 Linux 内核里最简单的 I/O 调度器。此调度程序最适合于固态硬盘。</p>
<h2 id="Anticipatory"><a href="#Anticipatory" class="headerlink" title="Anticipatory"></a>Anticipatory</h2><p>Anticipatory 的中文含义是”预料的，预想的”，顾名思义有个 I/O 发生的时候，如果又有进程请求 I/O 操作，则将产生一个默认的 6 毫秒猜测时间，猜测下一个进程请求 I/O 是要干什么的。这个 I/O 调度器对读操作优化服务时间，在提供一个 I/O 的时候进行短时间等待，使进程能够提交到另外的 I/O。Anticipatory 算法从 Linux 2.6.33 版本后被删除了，因为使用 CFQ 通过配置也能达到 Anticipatory 的效果。</p>
<h2 id="DeadLine"><a href="#DeadLine" class="headerlink" title="DeadLine"></a>DeadLine</h2><p>Deadline 翻译成中文是截止时间调度器，它避免有些请求太长时间不能被处理。另外可以区分对待读操作和写操作。DEADLINE 额外分别为读 I/O 和写 I/O 提供了 FIFO 队列。</p>
<h2 id="CFQ"><a href="#CFQ" class="headerlink" title="CFQ"></a>CFQ</h2><p>CFQ 全称 Completely Fair Scheduler ，中文名称完全公平调度器，它是现在许多 Linux 发行版的默认调度器，CFQ 是内核默认选择的 I/O 调度器。该算法的特点是按照 IO 请求的地址进行排序，而不是按照先来后到的顺序来进行响应。CFQ 为每个进程/线程，单独创建一个队列来管理该进程所产生的请求，也就是说每个进程一个队列，各队列之间的调度使用时间片来调度，</p>
<h1 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h1><h2 id="查看当前系统支持的I-O调度器"><a href="#查看当前系统支持的I-O调度器" class="headerlink" title="查看当前系统支持的I/O调度器"></a>查看当前系统支持的I/O调度器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[sankuai@dx-cloud-climc01 ~]$ dmesg | grep -i scheduler</span><br><span class="line">io scheduler noop registered</span><br><span class="line">io scheduler anticipatory registered</span><br><span class="line">io scheduler deadline registered</span><br><span class="line">io scheduler cfq registered (default)</span><br></pre></td></tr></table></figure>

<h2 id="查看一个硬盘使用的I-O调度器"><a href="#查看一个硬盘使用的I-O调度器" class="headerlink" title="查看一个硬盘使用的I/O调度器"></a>查看一个硬盘使用的I/O调度器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[sankuai@gh-cloud-mss-store02 ~]$ cat /sys/block/sda/queue/scheduler</span><br><span class="line">noop anticipatory deadline [cfq]</span><br></pre></td></tr></table></figure>

<h2 id="查看调度算法参数的含义"><a href="#查看调度算法参数的含义" class="headerlink" title="查看调度算法参数的含义"></a>查看调度算法参数的含义</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install kernel-doc</span><br><span class="line">比如:/usr/share/doc/kernel-doc-2.6.32/Documentation/block/deadline-iosched.txt</span><br></pre></td></tr></table></figure>

<h2 id="永久修改系统-IO-调度器"><a href="#永久修改系统-IO-调度器" class="headerlink" title="永久修改系统 IO 调度器"></a>永久修改系统 IO 调度器</h2><h3 id="grubby-命令"><a href="#grubby-命令" class="headerlink" title="grubby 命令"></a>grubby 命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> grubby --grub --update-kernel=ALL --args=<span class="string">&quot;elevator=deadline</span></span></span><br></pre></td></tr></table></figure>

<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">使用vi编辑器修改grub配置文件</span><br><span class="line"><span class="meta">#</span><span class="bash">vi cat /etc/default/grub</span></span><br><span class="line"><span class="meta">#</span><span class="bash">修改第五行，在行尾添加<span class="comment">#</span></span></span><br><span class="line">elevator= cfq</span><br><span class="line"> </span><br><span class="line">然后保存文件，重新编译配置文件，</span><br><span class="line"><span class="meta">#</span><span class="bash">grub2-mkconfig -o /boot/grub2/grub.cfg</span></span><br></pre></td></tr></table></figure>

<h1 id="算法调优"><a href="#算法调优" class="headerlink" title="算法调优"></a>算法调优</h1><h2 id="CFQ-算法参数"><a href="#CFQ-算法参数" class="headerlink" title="CFQ 算法参数"></a>CFQ 算法参数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[sankuai@gh-cloud-mss-store02 ~]$ ls -l /sys/block/sda/queue/iosched</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 back_seek_max</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 back_seek_penalty</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 fifo_expire_async</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 fifo_expire_sync</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 group_idle</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 group_isolation</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 low_latency</span><br><span class="line">-rw-r--r-- 1 root root 4096 May 24  2017 quantum</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 slice_async</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 slice_async_rq</span><br><span class="line">-rw-r--r-- 1 root root 4096 May 24  2017 slice_idle</span><br><span class="line">-rw-r--r-- 1 root root 4096 Jun  4 11:53 slice_sync</span><br></pre></td></tr></table></figure>

<ul>
<li><p>back_seek_max</p>
<p>默认 16384。该参数规定了磁头向后寻址的最大范围,默认值是16M。对于请求所访问的扇区号在磁头后方的请求，cfq 会像向前寻址的请求一样调度他。</p>
</li>
<li><p>back_seek_penalty</p>
<p>默认值是 2。该参数用来计算向后寻址的代价。相对于前方查找，后方查找的距离为 1/2(1/back_seek_penalty)时，cfq 调度时就认为这两个请求寻址的代价是相同的。</p>
</li>
<li><p>fifo_expire_async</p>
<p>默认值是250ms。该参数用来控制异步请求的超时时间。如果队列被激活后，则优先检查是否有请求超时，如果有超时的请求，则派发。但是，在队列激活的期间内，只会派发 一个超时的请求，其余的请求按照请求的优先级，以及所访问的扇区号大小来派发。</p>
</li>
<li><p>fifo_expire_sync</p>
<p>默认值是125ms。功能类似于fifo_expire_async参数，该参数用于控制同步请求的超时时间，。</p>
</li>
<li><p>group_idle</p>
<p>默认值是 8ms，该参数为了提高吞吐量。</p>
</li>
<li><p>group_isolation</p>
<p>该参数用来标识应用程序所在的cgroup。</p>
</li>
<li><p>low_latency</p>
<p>该参数用来表示低延迟，默认值是1ms</p>
</li>
<li><p>quantum</p>
<p>该参数用于控制队列派发到设备驱动层所含有的请求数，默认值是8。不管是同步队列还是异步队列, 在时间片内，超过这个限制，则不再派发请求。对于异步队列 而言，请求数的派发个数还取决于参数slice_async_rq。</p>
</li>
<li><p>slice_async</p>
<p>默认值是 40ms。这个参数功能同slice_sync，但是用来计算异步队列的时间片。<br>异步队列的时间片的计算公式是：time slice＝slice_async + (slice_async/5 * (4 - priority))；</p>
</li>
<li><p>slice_async_rq</p>
<p>默认值是 2。这个参数用来计算在时间片内异步请求被派发的最大数。同样，最大请求数也依赖于队列的优先级。计算公式是：最大请求数＝2 * slice_async_rq( 8 –priority );</p>
</li>
<li><p>slice_idle</p>
<p>默认值是 8ms，这个参数只控制同步队列的idle time。当同步队列当前没有请求派发时，并不切换到其他队列，而是等待 8ms，以便让应用程序产生更多的请求。直到同步队列的时间片用完。</p>
</li>
<li><p>slice_sync</p>
<p>默认值是 100ms。这个参数用来计算同步队列的时间片, 默认值是100ms。时间片还依赖于队列的优先级。同步队列的时间片的计算公式是：time slice＝slice_sync + (slice_sync/5 * (4 - priority))；</p>
</li>
</ul>
<h2 id="Anticipatory-算法参数"><a href="#Anticipatory-算法参数" class="headerlink" title="Anticipatory 算法参数"></a>Anticipatory 算法参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">The parameters are:</span><br><span class="line">* read_expire</span><br><span class="line">    Controls how long until a read request becomes &quot;expired&quot;. It also controls the interval between which expired requests are served, so set to 50, a request might take anywhere &lt; 100ms to be serviced _if_ it is the next on the expired list. Obviously request expiration strategies won&#x27;t make the disk go faster. The result basically equates to the timeslice a single reader gets in the presence of other IO. 100*((seek time / read_expire) + 1) is very roughly the % streaming read efficiency your disk should get with multiple readers.</span><br><span class="line"></span><br><span class="line">* read_batch_expire</span><br><span class="line">    Controls how much time a batch of reads is given before pending writes are served. A higher value is more efficient. This might be set below read_expire if writes are to be given higher priority than reads, but reads are to be as efficient as possible when there are no writes. Generally though, it should be some multiple of read_expire.</span><br><span class="line"></span><br><span class="line">* write_expire, and</span><br><span class="line">* write_batch_expire are equivalent to the above, for writes.</span><br><span class="line"></span><br><span class="line">* antic_expire</span><br><span class="line">    Controls the maximum amount of time we can anticipate a good read (one with a short seek distance from the most recently completed request) before giving up. Many other factors may cause anticipation to be stopped early, or some processes will not be &quot;anticipated&quot; at all. Should be a bit higher for big seek time devices though not a linear correspondence - most processes have only a few ms thinktime.</span><br><span class="line"></span><br><span class="line">In addition to the tunables above there is a read-only file named est_time</span><br><span class="line">which, when read, will show:</span><br><span class="line"></span><br><span class="line">    - The probability of a task exiting without a cooperating task</span><br><span class="line">      submitting an anticipated IO.</span><br><span class="line"></span><br><span class="line">    - The current mean think time.</span><br><span class="line"></span><br><span class="line">    - The seek distance used to determine if an incoming IO is better.</span><br></pre></td></tr></table></figure>



<h2 id="测试-fio"><a href="#测试-fio" class="headerlink" title="测试-fio"></a>测试-fio</h2><p>可以使用专业的工具 fio，或者命令 dd。</p>
<h3 id="fio-格式"><a href="#fio-格式" class="headerlink" title="fio 格式"></a>fio 格式</h3><p>fio 可以采用命令行格式，也可以采用 jobfile 格式。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fio [options] [jobfile] ...</span><br><span class="line">  options</span><br><span class="line">    --output=filename</span><br></pre></td></tr></table></figure>

<h3 id="jobfile-参数"><a href="#jobfile-参数" class="headerlink" title="jobfile 参数"></a>jobfile 参数</h3><h4 id="General"><a href="#General" class="headerlink" title="General"></a>General</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runtime=time 单位：seconds</span><br></pre></td></tr></table></figure>

<h4 id="I-O-type"><a href="#I-O-type" class="headerlink" title="I/O type"></a>I/O type</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">direct=bool # 是否使用缓存，true 表示不使用缓存</span><br><span class="line">readwrite=str </span><br><span class="line">    read # 顺序读</span><br><span class="line">    write # 顺序写</span><br><span class="line">    randread # 随机读</span><br><span class="line">    randwrite # 随即写</span><br><span class="line">    rw # 顺序读写</span><br><span class="line">    randrw # 随机读写</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h4 id="Block-size"><a href="#Block-size" class="headerlink" title="Block size"></a>Block size</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">blocksize/bs=int[,int][,int] # read, writes, trimes，默认是 4096</span><br><span class="line">    bs=256k</span><br><span class="line">blocksize_range/bsrange=irange[,irange][,irange]</span><br><span class="line">    bsrange=1k-4k,2k-8k</span><br><span class="line">bssplit=str</span><br></pre></td></tr></table></figure>

<h4 id="Buffers-and-memory"><a href="#Buffers-and-memory" class="headerlink" title="Buffers and memory"></a>Buffers and memory</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iomem=str, mem=str</span><br><span class="line">    malloc</span><br><span class="line">    shm</span><br><span class="line">    shmhuge</span><br><span class="line">    mmap</span><br></pre></td></tr></table></figure>

<h4 id="I-O-size"><a href="#I-O-size" class="headerlink" title="I/O size"></a>I/O size</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">size=int # 一个任务中每一个线程的总大小</span><br><span class="line">io_size=int, io_limit=int</span><br><span class="line">filesize=irange(int)</span><br></pre></td></tr></table></figure>

<h4 id="I-O-engine"><a href="#I-O-engine" class="headerlink" title="I/O engine"></a>I/O engine</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ioengine=str</span><br><span class="line">    sync # 基本的读写操作</span><br><span class="line">    psync # 基本的 pread 和 pwrite</span><br><span class="line">    vsync # 基本的 readv 和 writev 将通过将相邻的 I/O 合并为一个提交来模拟排队。</span><br><span class="line">    libaio # Linux 原生的异步 I/O</span><br></pre></td></tr></table></figure>

<h4 id="I-O-depth"><a href="#I-O-depth" class="headerlink" title="I/O depth"></a>I/O depth</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iodepth=int # 线程的数量</span><br></pre></td></tr></table></figure>

<h4 id="I-O-rate"><a href="#I-O-rate" class="headerlink" title="I/O rate"></a>I/O rate</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">thinktime=time # I/O 发出后，在一段时间内停止，再发出下一个</span><br><span class="line">rate=int[,int][,int] # 限制某一个任务的带宽</span><br></pre></td></tr></table></figure>

<h4 id="I-O-latency"><a href="#I-O-latency" class="headerlink" title="I/O latency"></a>I/O latency</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">latency_target=time # 如果设置，fio将尝试查找给定工作负载运行时的最高性能点，同时保持低于此目标的延迟。</span><br></pre></td></tr></table></figure>

<h4 id="I-O-replay"><a href="#I-O-replay" class="headerlink" title="I/O replay"></a>I/O replay</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">write_iolog=str</span><br><span class="line">read_iolog=str</span><br></pre></td></tr></table></figure>

<h4 id="Threads-processes-and-job-synchronization"><a href="#Threads-processes-and-job-synchronization" class="headerlink" title="Threads, processes and job synchronization"></a>Threads, processes and job synchronization</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread # fio 默认是通过 fork 的方式创建任务，但是如果这个参数指定，就会采用 POSIX 的线程函数来创建线程</span><br></pre></td></tr></table></figure>

<h4 id="Verification"><a href="#Verification" class="headerlink" title="Verification"></a>Verification</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">verify_only # 不指定工作负载，只验证数据是否符合之前的</span><br></pre></td></tr></table></figure>

<h4 id="Steady-state"><a href="#Steady-state" class="headerlink" title="Steady state"></a>Steady state</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">steadystate=str:float, ss=str:float # 定义评估稳态性能的标准和限制。</span><br><span class="line">    iops # 收集 iops 数据 如：iops:2</span><br></pre></td></tr></table></figure>

<h4 id="Measurements-and-reporting"><a href="#Measurements-and-reporting" class="headerlink" title="Measurements and reporting"></a>Measurements and reporting</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">write_bw_log=str</span><br><span class="line">write_lat_log=str</span><br></pre></td></tr></table></figure>

<h3 id="相关测试用例"><a href="#相关测试用例" class="headerlink" title="相关测试用例"></a>相关测试用例</h3><h4 id="随机读"><a href="#随机读" class="headerlink" title="随机读"></a>随机读</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Rand_Read_Testing]</span><br><span class="line">direct=1</span><br><span class="line">iodepth=128</span><br><span class="line">rw=randread</span><br><span class="line">ioengine=libaio</span><br><span class="line">bs=4k</span><br><span class="line">size=1G</span><br><span class="line">numjobs=1</span><br><span class="line">runtime=1000</span><br><span class="line">group_reporting</span><br><span class="line">filename=/s3plus/mount/002/randread.test</span><br></pre></td></tr></table></figure>

<p>参考：<a target="_blank" rel="noopener" href="http://devopslinux.com/2016/07/23/PTE-fio/">http://devopslinux.com/2016/07/23/PTE-fio/</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">顺序读</span></span><br><span class="line">fio -filename=/dev/sda -direct=1 -iodepth 1 -thread -rw=read -ioengine=psync -bs=16k -size=200G -numjobs=30 -runtime=1000 -group_reporting -name=mytest</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">顺序写</span></span><br><span class="line">fio -filename=/dev/sda -direct=1 -iodepth 1 -thread -rw=write -ioengine=psync -bs=16k -size=200G -numjobs=30 -runtime=1000 -group_reporting -name=mytest</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">随机读</span></span><br><span class="line">fio -filename=/dev/sda -direct=1 -iodepth 1 -thread -rw=randread -ioengine=psync -bs=16k -size=200G -numjobs=30 -runtime=1000 -group_reporting -name=mytest</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">随机写</span></span><br><span class="line">fio -filename=/dev/sda -direct=1 -iodepth 1 -thread -rw=randwrite -ioengine=psync -bs=16k -size=200G -numjobs=30 -runtime=1000 -group_reporting -name=mytest</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">混合随机读写</span></span><br><span class="line">fio -filename=/dev/sda -direct=1 -iodepth 1 -thread -rw=randrw -rwmixread=70 -ioengine=psync -bs=16k -size=200G -numjobs=30 -runtime=100 -group_reporting -name=mytest -ioscheduler=noop</span><br></pre></td></tr></table></figure>

<h4 id="混合随机读写"><a href="#混合随机读写" class="headerlink" title="混合随机读写"></a>混合随机读写</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[randrw]</span><br><span class="line">direct=1</span><br><span class="line">iodepth=128</span><br><span class="line">rw=randrw</span><br><span class="line">ioengine=libaio</span><br><span class="line">bs=4k</span><br><span class="line">size=1G</span><br><span class="line">numjobs=16</span><br><span class="line">runtime=60</span><br><span class="line">group_reporting</span><br><span class="line">filename=/s3plus/mount/002/randrw.file</span><br></pre></td></tr></table></figure>







<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/linux/l-lo-io-scheduler-optimize-performance/index.html">https://www.ibm.com/developerworks/cn/linux/l-lo-io-scheduler-optimize-performance/index.html</a></p>
<p><a target="_blank" rel="noopener" href="http://bbs.chinaunix.net/thread-1967733-1-1.html">http://bbs.chinaunix.net/thread-1967733-1-1.html</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Linux/" rel="tag"># Linux</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/05/30/text-command/" rel="prev" title="文本处理命令">
      <i class="fa fa-chevron-left"></i> 文本处理命令
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/06/11/target-offer/" rel="next" title="剑指 offer——Python 实现">
      剑指 offer——Python 实现 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#IO-%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95"><span class="nav-text">IO 调度算法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#NOOP"><span class="nav-text">NOOP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Anticipatory"><span class="nav-text">Anticipatory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DeadLine"><span class="nav-text">DeadLine</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CFQ"><span class="nav-text">CFQ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="nav-text">相关命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%B3%BB%E7%BB%9F%E6%94%AF%E6%8C%81%E7%9A%84I-O%E8%B0%83%E5%BA%A6%E5%99%A8"><span class="nav-text">查看当前系统支持的I&#x2F;O调度器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E4%B8%80%E4%B8%AA%E7%A1%AC%E7%9B%98%E4%BD%BF%E7%94%A8%E7%9A%84I-O%E8%B0%83%E5%BA%A6%E5%99%A8"><span class="nav-text">查看一个硬盘使用的I&#x2F;O调度器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95%E5%8F%82%E6%95%B0%E7%9A%84%E5%90%AB%E4%B9%89"><span class="nav-text">查看调度算法参数的含义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B0%B8%E4%B9%85%E4%BF%AE%E6%94%B9%E7%B3%BB%E7%BB%9F-IO-%E8%B0%83%E5%BA%A6%E5%99%A8"><span class="nav-text">永久修改系统 IO 调度器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#grubby-%E5%91%BD%E4%BB%A4"><span class="nav-text">grubby 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">配置文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AE%97%E6%B3%95%E8%B0%83%E4%BC%98"><span class="nav-text">算法调优</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#CFQ-%E7%AE%97%E6%B3%95%E5%8F%82%E6%95%B0"><span class="nav-text">CFQ 算法参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Anticipatory-%E7%AE%97%E6%B3%95%E5%8F%82%E6%95%B0"><span class="nav-text">Anticipatory 算法参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95-fio"><span class="nav-text">测试-fio</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#fio-%E6%A0%BC%E5%BC%8F"><span class="nav-text">fio 格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jobfile-%E5%8F%82%E6%95%B0"><span class="nav-text">jobfile 参数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#General"><span class="nav-text">General</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#I-O-type"><span class="nav-text">I&#x2F;O type</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Block-size"><span class="nav-text">Block size</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Buffers-and-memory"><span class="nav-text">Buffers and memory</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#I-O-size"><span class="nav-text">I&#x2F;O size</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#I-O-engine"><span class="nav-text">I&#x2F;O engine</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#I-O-depth"><span class="nav-text">I&#x2F;O depth</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#I-O-rate"><span class="nav-text">I&#x2F;O rate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#I-O-latency"><span class="nav-text">I&#x2F;O latency</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#I-O-replay"><span class="nav-text">I&#x2F;O replay</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Threads-processes-and-job-synchronization"><span class="nav-text">Threads, processes and job synchronization</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Verification"><span class="nav-text">Verification</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Steady-state"><span class="nav-text">Steady state</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Measurements-and-reporting"><span class="nav-text">Measurements and reporting</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B"><span class="nav-text">相关测试用例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA%E8%AF%BB"><span class="nav-text">随机读</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%B7%E5%90%88%E9%9A%8F%E6%9C%BA%E8%AF%BB%E5%86%99"><span class="nav-text">混合随机读写</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="原少子杨"
      src="https://s3plus.meituan.net/v1/mss_f32142e8d47149129e9550e929704625/yzz-test-image/qrcode_for_gh_3cfae3cf61d9_1280.jpg">
  <p class="site-author-name" itemprop="name">原少子杨</p>
  <div class="site-description" itemprop="description">目前是一名 SRE，爱好 Go 和 Python</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">133</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">原少子杨</span>
</div>
  <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly9waXNjZXMudGhlbWUtbmV4dC5vcmc=">NexT.Pisces</span> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '6OsbpvAuMocftjPmQVE5FgOG-gzGzoHsz',
      appKey     : 'Nzz2gSaPPFT179OKLQwrJB6v',
      placeholder: "欢迎留言和我交流",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
